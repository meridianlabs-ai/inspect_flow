---
title: "Inspect Flow"
description: "Workflow Orchestration for Inspect AI"
tbl-colwidths: [30,70]
---

## Introduction

Inspect Flow is a workflow orchestration tool for [Inspect AI](https://inspect.aisi.org.uk/) that enables you to run evaluations at scale with repeatability and maintainability.

**Why Inspect Flow?** As evaluation workflows grow in complexity—running multiple tasks across different models with varying parameters—managing these experiments becomes challenging. Inspect Flow addresses this by providing:

1.  **Declarative Configuration**: Define complex evaluations with tasks, models, and parameters in type-safe schemas
2.  **Repeatable & Shareable**: Encapsulated definitions of tasks, models, configurations, and Python dependencies ensure experiments can be reliably repeated and shared
3.  **Incremental Execution**: Add new models, tasks, or configurations to existing results without re-running completed work
4.  **Parameter Sweeping**: Matrix patterns for systematic exploration across tasks, models, and hyperparameters

Inspect Flow is designed for researchers and engineers running systematic AI evaluations who need to scale beyond ad-hoc scripts.

## Getting Started

::: callout-note
### Prerequisites

Before using Inspect Flow, you should:

-   Have familiarity with [Inspect AI](https://inspect.aisi.org.uk/)
-   Have an existing Inspect evaluation or use one from [inspect-evals](https://github.com/UKGovernmentBEIS/inspect_evals)
:::

### Installation

Install the `inspect_flow` package from PyPI as follows:

``` bash
pip install inspect-flow
```

### Set up API keys

You'll need API keys for the model providers you want to use. Set the relevant provider API key in your `.env` file or export it in your shell:

::: {.panel-tabset .code-tabset}
#### OpenAI

``` bash
export OPENAI_API_KEY=your-openai-api-key
```

#### Anthropic

``` bash
export ANTHROPIC_API_KEY=your-anthropic-api-key
```

#### Google

``` bash
export GOOGLE_API_KEY=your-google-api-key
```

#### Grok

``` bash
export GROK_API_KEY=your-grok-api-key
```

#### Mistral

``` bash
export MISTRAL_API_KEY=your-mistral-api-key
```

#### Hugging Face

``` bash
export HF_TOKEN=your-hf-token
```
:::

### Optional: VS Code extension

Optionally install the [Inspect AI VS Code Extension](https://inspect.aisi.org.uk/vscode.html) which includes features for viewing evaluation log files.

## Basic Examples

Let's walk through creating your first Flow configuration. We'll use `FlowJob` (the entrypoint class) and `FlowTask` to define evaluations.

::: {.callout-tip collapse="true"}
### Core Components Reference

-   `types.FlowJob` — Pydantic class that encapsulates the declarative description of a Flow job.
-   `types.FlowTask` — Pydantic class abstraction on top of Inspect AI [Task](https://inspect.aisi.org.uk/tasks.html).
-   `types.FlowModel` — Pydantic class abstraction on top of Inspect AI [Model](https://inspect.aisi.org.uk/models.html).
-   `tasks_matrix` — Helper function for parameter sweeping to generate a list of tasks with all parameter combinations.
-   `models_matrix` — Helper function for parameter sweeping to generate a list of models with all parameter combinations.
-   `configs_matrix` — Helper function for parameter sweeping to generate a list of GenerateConfig with all parameter combinations.
:::

`FlowJob` is the main entrypoint for defining evaluation runs. At its core, it takes a list of tasks to run. Here's a simple example that runs two evaluations:

``` {.python filename="config.py"}
{{< include ../examples/config.py >}}
```

To run the evaluations, run the following command in your shell. This will create a virtual environment for this job run and install the dependencies. Note that task and model dependencies (like the `inspect-evals` and `openai` Python packages) are inferred and installed automatically.

``` bash
flow run config.py
```

This will run both tasks and display progress in your terminal.

![Progress bar in terminal](images/config_progress_terminal.png)

### Matrix Functions

Often you'll want to evaluate multiple tasks across multiple models. Rather than manually defining every combination, use `tasks_matrix` to generate all task-model pairs:

``` {.python filename="matrix.py"}
{{< include ../examples/matrix.py >}}
```

To preview the expanded config before running it, you can run the following command in your shell to ensure the generated config is the one that you intend to run.

``` bash
flow config matrix.py
```

This command outputs the expanded configuration showing all 4 task-model combinations (2 tasks × 2 models).

``` {.yml filename="matrix.yml"}
{{< include ../examples/matrix.yml >}}
```

`tasks_matrix` and `models_matrix` are powerful functions that can operate on multiple levels of nested matrixes which enable sophisticated parameter sweeping. Let's say you want to explore different reasoning efforts across models—you can achieve this with the `models_matrix` function.

``` {.python filename="models_matrix.py"}
{{< include ../examples/models_matrix.py >}}
```

For even more concise parameter sweeping, use `configs_matrix` to generate configuration variants. This produces the same 16 evaluations (2 tasks × 2 models × 4 reasoning levels) as above, but with less boilerplate:

``` {.python filename="configs_matrix.py"}
{{< include ../examples/configs_matrix.py >}}
```

To run the config:

``` bash
flow run matrix.py
```

This will run all 16 evaluations (2 tasks × 2 models × 4 reasoning levels). When complete, you'll find a link to the logs at the bottom of the task results summary.

![Log path printed in terminal](images/matrix_logs_terminal.png)

To view logs interactively, run:

``` bash
inspect view
```

![Inspect View](images/index_inspect_view.png)

## Learning More

See the following articles to learn more about using Flow:

-   [Core Concepts](core_concepts.qmd): Flow data type system and config structure.
-   [Config Basics](config_basics.qmd): Build and understand your first Flow config.
-   [Reference](reference/index.qmd): Detailed documentation on the Flow Python API and CLI commands.