---
title: "Defaults, Inheritance and Overrides"
tbl-colwidths: [30,70]
---

Inspect Flow provides powerful mechanisms to avoid repetition and share configuration across evaluations. This page covers:

- **FlowDefaults** - Setting default values within a job that cascade across tasks, models, solvers, and agents
- **Config Inheritance** - Reusing and composing configurations across multiple files
- **CLI Overrides** - Overriding any config value at runtime

## FlowDefaults {#flowdefaults}

`FlowDefaults` supports multiple levels of default configuration:

``` {.python filename="config.py"}
{{< include ../examples/flow_defaults.py >}}
```

1.  Default model generation options. Will be overridden by settings on FlowTask and FlowModel.

2.  Field defaults for models.

3.  Model defaults for model name prefixes. Overrides `FlowDefaults.config` and `FlowDefaults.model`. If multiple prefixes match, **longest prefix wins**.

4.  Field defaults for solvers.

5.  Solver defaults for solver name prefixes. Overrides `FlowDefaults.solver`. If multiple prefixes match, **longest prefix wins**.

6.  Field defaults for agents.

7.  Agent defaults for agent name prefixes. Overrides `FlowDefaults.agent`. If multiple prefixes match, **longest prefix wins**.

8.  Field defaults for tasks.

9.  Task defaults for task name prefixes. Overrides `FlowDefaults.config` and `FlowDefaults.task`. If multiple prefixes match, **longest prefix wins**.

## Merge Priority

Defaults follow a hierarchy where **more specific settings override less specific ones**:

**For GenerateConfig:**

1.  Global config defaults (`defaults.config`)
2.  Global model config defaults (`defaults.model.config`)
3.  Model prefix config defaults (`defaults.model_prefix.config`)
4.  Task-specific config (`task.config`)
5.  Model-specific config (`model.config`) — **highest priority**

**Example hierarchy in action:**

``` {.python filename="config.py"}
{{< include ../examples/hierarchy.py >}}
```

1.  Global defaults: `temperature=0.0, max_tokens=100`
2.  Prefix defaults override: `temperature=0.5` (for OpenAI models)
3.  Task config overrides: `temperature=0.7`
4.  **Model config wins**: `temperature=1.0, max_tokens=100`

**Final result:** `temperature=1.0` (most specific), `max_tokens=100` (from global defaults)

::: callout-note
### None Values and Merge Behavior

**For fields in Flow types:** Most fields use a special "not given" default, which means `None` is a meaningful value that **does override**:

``` {.python filename="config.py"}
{{< include ../examples/merge_none_flow_task.py >}}
```

To avoid overriding a FlowTask field, omit it entirely rather than setting it to `None`.

**For GenerateConfig and other Inspect types:** Setting a field to `None` means "not specified" — it won't override existing values from defaults:

``` {.python filename="config.py"}
{{< include ../examples/merge_none_generate_config.py >}}
```
:::

## Inheritance {#inheritance}

Inspect Flow supports configuration inheritance to share settings across multiple config files. This is particularly useful for defining global defaults at a repository level that apply to all evaluations.

### Includes

Use the `includes` field to explicitly merge other config files into your job:

```python
FlowJob(
    includes=["defaults.py"],
    log_dir="logs",
    tasks=["my_task"]
)
```

#### Merge

Included configs are merged recursively, with the current config's values taking precedence over included values:

- **Dictionaries**: Fields are merged deeply (recursive merge)
- **Lists**: Items are concatenated with duplicates removed
- **Scalars**: Current config values override included values

#### Order

Includes are processed sequentially in the order they appear. When multiple includes are specified, earlier includes take precedence over later ones.

#### Recursion

Included files can themselves have `includes` fields, which are expanded recursively. This allows you to build hierarchies of configuration.

#### Path Resolution

Relative paths will be resolved relative to the config file (when using the CLI) or `base_dir` arg (when using the API):

``` {.python filename="config.py"}
{{< include ../examples/includes.py >}}
```

### Automatic Discovery

Inspect Flow automatically discovers and includes files named `_flow.py` in parent directories. Starting from your config file's location, it searches upward through the directory tree for `_flow.py` files and automatically merges them as base configurations.

This allows you to define shared defaults (model settings, dependencies, etc.) at a repository root that apply to all configs in subdirectories without explicit includes.

::: callout-note
Automatic discovery does not look for `_flow.py` files in the parent directories of explicitly included files.
:::

### Using Inheritance with Defaults

Config inheritance is especially powerful when combined with `FlowDefaults`. You can define global defaults in a `_flow.py` file at your repository root:

``` {.python filename="_flow.py"}
{{< include ../examples/inheritance_root_config.py >}}
```

Then all configs in subdirectories automatically inherit these defaults, which can be selectively overridden:

``` {.python filename="experiments/config.py"}
{{< include ../examples/inheritance_subdir_config.py >}}
```

::: callout-tip
### Preventing Overrides

When using inheritance to define shared defaults, you can enforce critical settings by preventing including configs from overriding them. See [Lock Configuration Fields](advanced.qmd#lock-configuration-fields) in the Advanced section to learn how to lock inherited or default values and prevent them from being overwritten.
:::

## CLI Overrides {#cli-overrides}

Override config values at runtime using the `--set` flag:

::: {.panel-tabset .code-tabset}
#### Basic usage

``` bash
flow run config.py --set log_dir=./logs
```

#### Nested paths

``` bash
flow run config.py --set options.limit=10
flow run config.py --set defaults.solver.args.tool_calls=none
```

#### JSON dicts

``` bash
flow run config.py --set 'options.metadata={"experiment": "baseline", "version": "v1"}'
```

#### Multiple overrides

``` bash
flow run config.py \
  --set log_dir=./logs/experiment1 \
  --set options.limit=100 \
  --set defaults.config.temperature=0.5
```
:::

::: callout-note
### Override Behavior

-   **Strings**: Replace existing values
-   **Dicts**: Replace existing values
-   **Lists**:
    -   String values append to existing list
    -   Lists replace existing list

**Examples:**

``` bash
# Appends to list
--set dependencies=new_package

# Replaces list
--set 'dependencies=["pkg1", "pkg2"]'
```
:::

## Env Vars

Set config values via environment variables:

``` bash
export INSPECT_FLOW_LOG_DIR=./logs/custom
export INSPECT_FLOW_LIMIT=50
export INSPECT_FLOW_SET="options.metadata={\"key\": \"value\"}"
export INSPECT_FLOW_VAR="task_min_priority=2"
flow run config.py
```

**Supported environment variables:**

| Variable                              | Equivalent Flag            | Description                                              |
|---------------------------------------|----------------------------|----------------------------------------------------------|
| `INSPECT_FLOW_LOG_DIR`                | `--log-dir`                | Override log directory                                   |
| `INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE`  | `--log-dir-create-unique`  | Create new log directory with numeric suffix if exists   |
| `INSPECT_FLOW_LOG_LEVEL`              | `--log-level`              | Inspect Flow log level. Defaults to Info. Use options.log_level to set the Inspect AI log level.
| `INSPECT_FLOW_LIMIT`                  | `--limit`                  | Limit number of samples                                  |
| `INSPECT_FLOW_SET`                    | `--set`                    | Set config overrides (can be specified multiple times)   |
| `INSPECT_FLOW_ARG`                    | `--arg`                    | Args to pass to job functions in the config file (can be multiple)      |
| `INSPECT_FLOW_NO_VENV`                | `--no-venv`                | Do not create a virtual environment to run the Flow job |
| `INSPECT_FLOW_DRY_RUN`                | `--dry-run`                | Create virtual environment and print number of tasks without running |
| `INSPECT_FLOW_RESOLVE`                | `--resolve`                | Fully resolve the config file (creates virtual environment) when running `flow config`|

::: callout-tip
### Override Priority

Setting defaults via the command line will override the defaults which in turn might be overridden by anything set explicitly.

Dedicated environment variables (see **Supported environment variables** above) and corresponding CLI flags will override the `--set` flag.

Dedicated CLI flags have the highest priority.

Priority order of `log-dir`, `log-dir-create-unique` and `limit`:

1.  FlowJob defaults
2.  Explicit setting on the FlowJob
3.  `INSPECT_FLOW_SET_` environment variables
4.  CLI `--set` flags
5.  `INSPECT_FLOW_LOG_DIR`, `INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE` and `INSPECT_FLOW_LIMIT` environment variables
6.  Explicit `--log-dir`, `--log-dir-create-unique` and `--limit` CLI flags

All other settings follow the priority order:

1.  FlowJob defaults
2.  Explicit setting on the FlowJob
3.  `INSPECT_FLOW_SET_` environment variables
4.  CLI `--set` flags
:::

## Debugging

To see the fully resolved configuration with all defaults, inheritance, and overrides applied:

``` bash
flow config config.py --resolve
```

This shows exactly what settings each task will use after applying all defaults and overrides.