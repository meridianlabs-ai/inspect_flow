---
title: "Defaults and Overrides"
tbl-colwidths: [30,70]
---

Inspect Flow provides a powerful defaults system to avoid repetition when configuring evaluations. The `FlowDefaults` field lets you set default values that cascade across tasks, models, solvers, and agents—with more specific settings overriding less specific ones.

## The FlowDefaults System

`FlowDefaults` supports multiple levels of default configuration:

``` python
from inspect_flow import (
    FlowJob,
    FlowDefaults,
    GenerateConfig,
    FlowModel,
    FlowSolver,
    FlowAgent,
    FlowTask,
)

FlowJob(
    defaults=FlowDefaults(
        config=GenerateConfig(                          # <1>
            max_connections=10,                         # <1>
        ),                                              # <1>
        model=FlowModel(                                # <2>
            model_args={"arg": "foo"},                  # <2>
        ),                                              # <2>
        model_prefix={                                  # <3>
            "openai/": FlowModel(                       # <3>
                config=GenerateConfig(                  # <3>
                    max_connections=20                  # <3>
                ),                                      # <3>
            ),                                          # <3>
        },                                              # <3>
        solver=FlowSolver(...),                         # <4>
        solver_prefix={"chain_of_thought": ...},        # <5>
        agent=FlowAgent(...),                           # <6>
        agent_prefix={"inspect/": ...},                 # <7>
        task=FlowTask(...),                             # <8>
        task_prefix={"inspect_evals/": ...},            # <9>
    ),
    tasks=[...]
)
```

1.  Default model generation options. Will be overridden by settings on FlowTask and FlowModel.

2.  Field defaults for models.

3.  Model defaults for model name prefixes. Overrides `FlowDefaults.config` and `FlowDefaults.model`. If multiple prefixes match, **longest prefix wins**.

4.  Field defaults for solvers.

5.  Solver defaults for solver name prefixes. Overrides `FlowDefaults.solver`. If multiple prefixes match, **longest prefix wins**.

6.  Field defaults for agents.

7.  Agent defaults for agent name prefixes. Overrides `FlowDefaults.agent`. If multiple prefixes match, **longest prefix wins**.

8.  Field defaults for tasks.

9.  Task defaults for task name prefixes. Overrides `FlowDefaults.config` and `FlowDefaults.task`. If multiple prefixes match, **longest prefix wins**.

## Merge Priority and Behavior

Defaults follow a hierarchy where **more specific settings override less specific ones**:

**For GenerateConfig:**

1.  Global config defaults (`defaults.config`)
2.  Global model config defaults (`defaults.model.config`)
3.  Model prefix config defaults (`defaults.model_prefix.config`)
4.  Task-specific config (`task.config`)
5.  Model-specific config (`model.config`) — **highest priority**

**Example hierarchy in action:**

``` {.python filename="hierarchy.py"}
{{< include ../examples/hierarchy.py >}}
```

1.  Global defaults: `temperature=0.0, max_tokens=100`
2.  Prefix defaults override: `temperature=0.5` (for OpenAI models)
3.  Task config overrides: `temperature=0.7`
4.  **Model config wins**: `temperature=1.0, max_tokens=100`

**Final result:** `temperature=1.0` (most specific), `max_tokens=100` (from global defaults)

::: callout-note
### None Values and Merge Behavior

**For GenerateConfig and most Flow types:** Setting a field to `None` means "not specified" — it won't override existing values from defaults:

``` python
FlowJob(
    defaults=FlowDefaults(
        config=GenerateConfig(temperature=0.8, max_tokens=1000)
    ),
    tasks=[
        FlowTask(
            config=GenerateConfig(temperature=0.5, max_tokens=None)
        )
    ]
)
# Result: Task runs with temperature=0.5, max_tokens=1000
# The max_tokens=None didn't override the default 1000
```

**For FlowTask fields:** Most fields use a special "not given" default, which means `None` is a meaningful value that **does override**:

``` python
FlowJob(
    defaults=FlowDefaults(model="gpt-4"),
    tasks=[
        FlowTask(model=None)  # Explicitly set to None
    ]
)
# Result: Task uses model=None (overrides the default "gpt-4")
```

To avoid overriding a FlowTask field, omit it entirely rather than setting it to `None`.
:::

## CLI Overrides {#cli-overrides}

Override config values at runtime using the `--set` flag:

::: {.panel-tabset .code-tabset}
#### Basic usage

``` bash
flow run config.py --set log_dir=./logs
```

#### Nested paths

``` bash
flow run config.py --set options.limit=10
flow run config.py --set defaults.solver.args.tool_calls=none
```

#### JSON dicts

``` bash
flow run config.py --set 'options.metadata={"experiment": "baseline", "version": "v1"}'
```

#### Multiple overrides

``` bash
flow run config.py \
  --set log_dir=./logs/experiment1 \
  --set options.limit=100 \
  --set defaults.config.temperature=0.5
```
:::

::: callout-note
### Override Behavior

-   **Strings**: Replace existing values
-   **Dicts**: Replace existing values
-   **Lists**:
    -   String values append to existing list
    -   Lists replace existing list

**Examples:**

``` bash
# Appends to list
--set dependencies=new_package

# Replaces list
--set 'dependencies=["pkg1", "pkg2"]'
```
:::

## Environment Variables

Set config values via environment variables:

``` bash
export INSPECT_FLOW_LOG_DIR=./logs/custom
export INSPECT_FLOW_LIMIT=50
export INSPECT_FLOW_SET="options.metadata={\"key\": \"value\"}"
export INSPECT_FLOW_VAR="task_min_priority=2"
flow run config.py
```

**Supported environment variables:**

| Variable                              | Equivalent Flag            | Description                                              |
|---------------------------------------|----------------------------|----------------------------------------------------------|
| `INSPECT_FLOW_LOG_DIR`                | `--log-dir`                | Override log directory                                   |
| `INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE`  | `--log-dir-create-unique`  | Create new log directory with numeric suffix if exists   |
| `INSPECT_FLOW_LOG_LEVEL`              | `--log-level`              | Inspect Flow log level. Defaults to Info. Use options.log_level to set the Inspect AI log level.
| `INSPECT_FLOW_LIMIT`                  | `--limit`                  | Limit number of samples                                  |
| `INSPECT_FLOW_SET`                    | `--set`                    | Set config overrides (can be specified multiple times)   |
| `INSPECT_FLOW_ARG`                    | `--arg`                    | Args to pass to job functions in the config file (can be multiple)      |
| `INSPECT_FLOW_NO_VENV`                | `--no-venv`                | Do not create a virtual environment to run the Flow job |
| `INSPECT_FLOW_DRY_RUN`                | `--dry-run`                | Create virtual environment and print number of tasks without running |

::: callout-tip
### Override Priority

Setting defaults via the command line will override the defaults which in turn might be overridden by anything set explicitly.

Dedicated environment variables (see **Supported environment variables** above) and corresponding CLI flags will override the `--set` flag.

Dedicated CLI flags have the highest priority.

Priority order of `log-dir`, `log-dir-create-unique` and `limit`:

1.  FlowJob defaults
2.  Explicit setting on the FlowJob
3.  `INSPECT_FLOW_SET_` environment variables
4.  CLI `--set` flags
5.  `INSPECT_FLOW_LOG_DIR`, `INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE` and `INSPECT_FLOW_LIMIT` environment variables
6.  Explicit `--log-dir`, `--log-dir-create-unique` and `--limit` CLI flags

All other settings follow the priority order:

1.  FlowJob defaults
2.  Explicit setting on the FlowJob
3.  `INSPECT_FLOW_SET_` environment variables
4.  CLI `--set` flags
:::

## Debugging Defaults Resolution

To see the fully resolved configuration with all defaults applied:

``` bash
flow run config.py --dry-run
```

This shows exactly what settings each task will use after applying all defaults and overrides.