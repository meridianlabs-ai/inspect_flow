---
title: "Matrixing"
tbl-colwidths: [30,70]
---

Matrixing lets you systematically explore evaluation configurations by generating Cartesian products of parameters. Instead of manually writing every combination, Flow provides matrix and "with" functions to declaratively generate evaluation grids.

## Matrix Functions (Cartesian Products)

Matrix functions generate all combinations of their parameters using Cartesian products.

### tasks_matrix()

Generate task configurations by combining tasks with models, configs, solvers, and arguments:

``` {.python filename="tasks_matrix.py"}
{{< include ../examples/tasks_matrix.py >}}
```

This creates **4 tasks** (2 tasks × 2 models).

### models_matrix()

Generate model configurations with different generation settings:

``` {.python filename="models_matrix.py"}
{{< include ../examples/models_matrix.py >}}
```

This creates **16 tasks** (2 task × 2 models × 4 resoning_effort).

### configs_matrix()

Generate generation config combinations by specifying individual parameters:

``` {.python filename="configs_matrix.py"}
{{< include ../examples/configs_matrix.py >}}
```

This creates **16 tasks** (2 task × 2 models × 4 resoning_effort).

### solvers_matrix() and agents_matrix()

Generate solver or agent configurations with different arguments:

``` {.python filename="solvers_matrix.py"}
{{< include ../examples/solvers_matrix.py >}}
```

This creates **3 tasks** (1 task × 3 solver configurations).

## With Functions (Apply to All)

"With" functions apply the same value to all items in a list. Use these when you want to sweep over some parameters while keeping others constant.

### tasks_with()

Apply common settings to multiple tasks:

``` {.python filename="tasks_with.py"}
{{< include ../examples/tasks_with.py >}}
```

This creates **2 tasks** (2 tasks, each with the same model and config).

### Combining Matrix and With

Mix parameter sweeps with common settings:

``` {.python filename="matrix_and_with.py"}
{{< include ../examples/matrix_and_with.py >}}
```

## Nested Sweeps

Matrix functions can be nested to create complex parameter grids. Use the unpacking operator `*` to expand inner matrix results:

**Example: Tasks with nested model sweep**

``` {.python filename="nested_model_sweep.py"}
{{< include ../examples/nested_model_sweep.py >}}
```

This creates **10 tasks** (2 tasks × 5 model configurations).

**Example: Tasks with nested task sweep**

``` {.python filename="nested_task_sweep.py"}
{{< include ../examples/nested_task_sweep.py >}}
```

This creates **8 tasks** (4 task variants × 2 models).

::: callout-warning
### Watch Out for Combinatorial Explosion

Parameter sweeps grow multiplicatively. A sweep with: - 3 tasks - 4 models - 5 temperature values - 3 solver configurations

Results in 3 × 4 × 5 × 3 = **180 evaluations**.

Always use `--dry-run` to check the number of evaluations before running expensive grids.
:::

## Config Merging Behavior

When base objects already have values, matrix parameters are merged:

``` python
# Config fields merge recursively
tasks_matrix(
    task=FlowTask(
        name="task",
        config=GenerateConfig(temperature=0.5)  # Base value
    ),
    config=[
        GenerateConfig(max_tokens=1000),  # Adds max_tokens, keeps temperature=0.5
        GenerateConfig(max_tokens=2000),  # Adds max_tokens, keeps temperature=0.5
    ]
)
```