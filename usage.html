<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Flow – Inspect Flow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./usage.qmd#core-concepts" rel="next">
<link href="./index.qmd#basic-examples" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-22869aebc48a7c55b6e09da1841cdd1b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Inspect Flow">
<meta property="og:description" content="Workflow orchestration for Inspect AI">
<meta property="og:site_name" content="Inspect Flow">
<meta name="twitter:title" content="Inspect Flow">
<meta name="twitter:description" content="Workflow orchestration for Inspect AI">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Inspect Flow</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./usage.html"> 
<span class="menu-text">Usage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./usage.html">Using Flow</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#introduction" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#getting-started" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#basic-examples" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./usage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Using Flow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#core-concepts" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#creating-flow-configs" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating Flow Configs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#dependency-management" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dependency Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#defaults-and-overrides" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Defaults and Overrides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#parameter-sweeping" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parameter Sweeping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#running-evaluations" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Running Evaluations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#advanced-features" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Features</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#core-concepts" id="toc-core-concepts" class="nav-link active" data-scroll-target="#core-concepts">Core Concepts</a>
  <ul class="collapse">
  <li><a href="#flow-type-system" id="toc-flow-type-system" class="nav-link" data-scroll-target="#flow-type-system">Flow Type System</a></li>
  <li><a href="#flow-config-structure" id="toc-flow-config-structure" class="nav-link" data-scroll-target="#flow-config-structure">Flow Config Structure</a></li>
  </ul></li>
  <li><a href="#creating-flow-configs" id="toc-creating-flow-configs" class="nav-link" data-scroll-target="#creating-flow-configs">Creating Flow Configs</a>
  <ul class="collapse">
  <li><a href="#your-first-config" id="toc-your-first-config" class="nav-link" data-scroll-target="#your-first-config">Your First Config</a></li>
  <li><a href="#task-specification" id="toc-task-specification" class="nav-link" data-scroll-target="#task-specification">Task Specification</a></li>
  <li><a href="#task-configuration" id="toc-task-configuration" class="nav-link" data-scroll-target="#task-configuration">Task Configuration</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  </ul></li>
  <li><a href="#dependency-management" id="toc-dependency-management" class="nav-link" data-scroll-target="#dependency-management">Dependency Management</a>
  <ul class="collapse">
  <li><a href="#how-virtual-environments-work" id="toc-how-virtual-environments-work" class="nav-link" data-scroll-target="#how-virtual-environments-work">How Virtual Environments Work</a></li>
  <li><a href="#specifying-dependencies" id="toc-specifying-dependencies" class="nav-link" data-scroll-target="#specifying-dependencies">Specifying Dependencies</a></li>
  <li><a href="#python-version-control" id="toc-python-version-control" class="nav-link" data-scroll-target="#python-version-control">Python Version Control</a></li>
  </ul></li>
  <li><a href="#defaults-and-overrides" id="toc-defaults-and-overrides" class="nav-link" data-scroll-target="#defaults-and-overrides">Defaults and Overrides</a>
  <ul class="collapse">
  <li><a href="#the-flowdefaults-system" id="toc-the-flowdefaults-system" class="nav-link" data-scroll-target="#the-flowdefaults-system">The FlowDefaults System</a></li>
  <li><a href="#merge-priority-and-behavior" id="toc-merge-priority-and-behavior" class="nav-link" data-scroll-target="#merge-priority-and-behavior">Merge Priority and Behavior</a></li>
  <li><a href="#cli-overrides" id="toc-cli-overrides" class="nav-link" data-scroll-target="#cli-overrides">CLI Overrides</a></li>
  <li><a href="#environment-variables" id="toc-environment-variables" class="nav-link" data-scroll-target="#environment-variables">Environment Variables</a></li>
  <li><a href="#debugging-defaults-resolution" id="toc-debugging-defaults-resolution" class="nav-link" data-scroll-target="#debugging-defaults-resolution">Debugging Defaults Resolution</a></li>
  </ul></li>
  <li><a href="#parameter-sweeping" id="toc-parameter-sweeping" class="nav-link" data-scroll-target="#parameter-sweeping">Parameter Sweeping</a>
  <ul class="collapse">
  <li><a href="#matrix-functions-cartesian-products" id="toc-matrix-functions-cartesian-products" class="nav-link" data-scroll-target="#matrix-functions-cartesian-products">Matrix Functions (Cartesian Products)</a></li>
  <li><a href="#with-functions-apply-to-all" id="toc-with-functions-apply-to-all" class="nav-link" data-scroll-target="#with-functions-apply-to-all">With Functions (Apply to All)</a></li>
  <li><a href="#nested-sweeps" id="toc-nested-sweeps" class="nav-link" data-scroll-target="#nested-sweeps">Nested Sweeps</a></li>
  <li><a href="#config-merging-behavior" id="toc-config-merging-behavior" class="nav-link" data-scroll-target="#config-merging-behavior">Config Merging Behavior</a></li>
  </ul></li>
  <li><a href="#running-evaluations" id="toc-running-evaluations" class="nav-link" data-scroll-target="#running-evaluations">Running Evaluations</a>
  <ul class="collapse">
  <li><a href="#the-flow-run-command" id="toc-the-flow-run-command" class="nav-link" data-scroll-target="#the-flow-run-command">The flow run Command</a></li>
  <li><a href="#the-flow-config-command" id="toc-the-flow-config-command" class="nav-link" data-scroll-target="#the-flow-config-command">The flow config Command</a></li>
  <li><a href="#results-and-logs" id="toc-results-and-logs" class="nav-link" data-scroll-target="#results-and-logs">Results and Logs</a></li>
  </ul></li>
  <li><a href="#advanced-features" id="toc-advanced-features" class="nav-link" data-scroll-target="#advanced-features">Advanced Features</a>
  <ul class="collapse">
  <li><a href="#metadata-management" id="toc-metadata-management" class="nav-link" data-scroll-target="#metadata-management">Metadata Management</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/meridianlabs-ai/inspect_flow/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Flow</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="core-concepts" class="level2">
<h2 class="anchored" data-anchor-id="core-concepts">Core Concepts</h2>
<section id="flow-type-system" class="level3">
<h3 class="anchored" data-anchor-id="flow-type-system">Flow Type System</h3>
<p>Inspect Flow mirrors Inspect AI’s object model with corresponding Flow types:</p>
<ul>
<li><strong><code>FlowJob</code></strong> — The top-level job definition. Under the hood it translates to an Inspect AI <a href="https://inspect.aisi.org.uk/eval-sets.html">Eval Set</a>. Contains a list of tasks and job settings.</li>
<li><strong><code>FlowTask</code></strong> — Configuration for a single evaluation task. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/tasks.html">Task</a> parameters.</li>
<li><strong><code>FlowModel</code></strong> — Model configuration including API settings and generation settings. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/models.html">Model</a>.</li>
<li><strong><code>FlowGenerateConfig</code></strong> — Model generation parameters. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/models.html#generation-config">GenerateConfig</a>.</li>
<li><strong><code>FlowSolver</code></strong> and <strong><code>FlowAgent</code></strong> — Solver and agent chain configuration. Map to Inspect AI <a href="https://inspect.aisi.org.uk/solvers.html">Solver</a> and <a href="https://inspect.aisi.org.uk/agents.html">Agent</a>.</li>
<li><strong><code>FlowOptions</code></strong> — Runtime execution options like concurrency limits, error handling, and logging preferences. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/eval-sets.html">eval_set()</a> parameters.</li>
<li><strong><code>FlowDefaults</code></strong> — System for setting default values across tasks, models, solvers, and agents.</li>
</ul>
</section>
<section id="flow-config-structure" class="level3">
<h3 class="anchored" data-anchor-id="flow-config-structure">Flow Config Structure</h3>
<p><code>FlowJob</code> is the primary interface for defining Flow workflows. All Flow operations—including <a href="#parameter-sweeping">parameter sweeps and matrix expansions</a>—ultimately produce a list of tasks that <code>FlowJob</code> executes.</p>
<p><strong>Required fields:</strong></p>
<ul>
<li><strong><code>tasks</code></strong> — List of <code>FlowTask</code> objects defining the evaluations to run</li>
</ul>
<p><strong>Optional fields:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>flow_dir</code></td>
<td>Directory for logs and resolved config. Supports S3 paths (e.g., <code>s3://bucket/path</code>)</td>
<td><code>"logs/flow"</code></td>
</tr>
<tr class="even">
<td><code>python_version</code></td>
<td>Python version for the isolated virtual environment (e.g., <code>"3.11"</code>)</td>
<td>Same as current environment</td>
</tr>
<tr class="odd">
<td><code>dependencies</code></td>
<td>PyPI packages, Git URLs, or local paths to install</td>
<td><code>[]</code></td>
</tr>
<tr class="even">
<td><code>env</code></td>
<td>Environment variables to set in the workflow execution context</td>
<td><code>{}</code></td>
</tr>
<tr class="odd">
<td><code>options</code></td>
<td>Runtime options (see <code>FlowOptions</code> reference)</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>defaults</code></td>
<td>Default values applied across tasks, models, and solvers</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="creating-flow-configs" class="level2">
<h2 class="anchored" data-anchor-id="creating-flow-configs">Creating Flow Configs</h2>
<section id="your-first-config" class="level3">
<h3 class="anchored" data-anchor-id="your-first-config">Your First Config</h3>
<p>In <a href="./index.html#basic-examples">Basic Examples</a>, we showed a simple <code>FlowJob</code>. Let’s break down what’s happening:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>config.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-1" data-filename="config.py"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-6" class="code-annotation-target"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-8" class="code-annotation-target"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-9" class="code-annotation-target"><a href="#annotated-cell-1-9" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="5" data-code-annotation="1">Install <a href="https://pypi.org/project/inspect-evals/"><code>inspect-evals</code></a> Python package</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="2">List evaluation tasks to run</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="8" data-code-annotation="3">Specify task from registry by name</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="9" data-code-annotation="4">Specify model to evaluate by name</span>
</dd>
</dl>
<p>To run the task, run the following command in your shell.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What happens when you run this?</strong></p>
<ol type="1">
<li>Flow creates an isolated virtual environment</li>
<li>Installs <code>inspect-evals</code> and <code>openai</code> (inferred from model)</li>
<li>Loads the <code>gpqa_diamond</code> task from the <code>inspect_evals</code> registry</li>
<li>Runs the evaluation with GPT-5</li>
<li>Stores results in <code>logs/flow/</code> (default log directory)</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Config File Evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Python config files are evaluated as normal Python code. The last expression in the file is used as the <code>FlowJob</code>. This means you can:</p>
<ul>
<li>Define variables and reuse them</li>
<li>Use loops or comprehensions to generate task lists</li>
<li>Import helper functions</li>
<li>Add comments and documentation</li>
</ul>
<p>Flow configs are just Python!</p>
</div>
</div>
</section>
<section id="task-specification" class="level3">
<h3 class="anchored" data-anchor-id="task-specification">Task Specification</h3>
<p>In the example above, we used a registry name (<code>"inspect_evals/gpqa_diamond"</code>). Flow supports multiple ways to reference tasks:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Registry Name</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">File Path</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">File with Function</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Tasks from installed packages.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"./my_task.py"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Auto-discovers <code>@task</code> decorated functions in the specified file and creates a task for each of them.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"./my_task.py@custom_eval"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Explicitly selects a specific function from the file.</p>
</div>
</div>
</div>
</section>
<section id="task-configuration" class="level3">
<h3 class="anchored" data-anchor-id="task-configuration">Task Configuration</h3>
<p><code>FlowTask</code> accepts parameters that map to Inspect AI <a href="https://inspect.aisi.org.uk/tasks.html">Task</a> fields:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"inspect_evals/mmlu_0_shot"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">3</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4">4</button><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>        max_tokens<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="5">5</button><span id="annotated-cell-3-9" class="code-annotation-target"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>    solver<span class="op">=</span><span class="st">"chain_of_thought"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="6">6</button><span id="annotated-cell-3-10" class="code-annotation-target"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a>    args<span class="op">=</span>{<span class="st">"subject"</span>: <span class="st">"physics"</span>},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="7">7</button><span id="annotated-cell-3-11" class="code-annotation-target"><a href="#annotated-cell-3-11" aria-hidden="true" tabindex="-1"></a>    sandbox<span class="op">=</span><span class="st">"docker"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="8">8</button><span id="annotated-cell-3-12" class="code-annotation-target"><a href="#annotated-cell-3-12" aria-hidden="true" tabindex="-1"></a>    sample_id<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="annotated-cell-3-13"><a href="#annotated-cell-3-13" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1"><strong>Task name</strong> — Maps to Inspect AI <code>Task.name</code>. Can be a registry name (<code>"inspect_evals/mmlu"</code>), file path (<code>"./task.py"</code>), or file with function (<code>"./task.py@eval_fn"</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="2"><strong>Model</strong> — Maps to Inspect AI <code>Task.model</code>. Optional model for this task. If not specified, uses the model from <code>INSPECT_EVAL_MODEL</code> environment variable. Can be a string (<code>"openai/gpt-5"</code>) or a <code>FlowModel</code> object for advanced configuration.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="3"><strong>Epochs</strong> — Maps to Inspect AI <code>Task.epochs</code>. Number of times to repeat evaluation over the dataset samples. Can be an integer (<code>epochs=3</code>) or a <code>FlowEpochs</code> object to specify custom reducer functions (<code>FlowEpochs(epochs=3, reducer="median")</code>). By default, scores are combined using the <code>"mean"</code> reducer across epochs.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5,6,7,8" data-code-annotation="4"><strong>Generation config</strong> — Maps to Inspect AI <code>Task.config</code> (<code>GenerateConfig</code>). Model generation parameters like <code>temperature</code>, <code>max_tokens</code>, <code>top_p</code>, <code>reasoning_effort</code>, etc. These settings override config on <code>FlowJob.config</code> but are overridden by settings on <code>FlowModel.config</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="9" data-code-annotation="5"><strong>Solver chain</strong> — Maps to Inspect AI <code>Task.solver</code>. The algorithm(s) for solving the task. Can be a string (<code>"chain_of_thought"</code>), <code>FlowSolver</code> object, <code>FlowAgent</code> object, or a list of solvers for chaining. Defaults to <code>generate()</code> if not specified.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="10" data-code-annotation="6"><strong>Task arguments</strong> — Maps to task function parameters. Dictionary of arguments passed to the task constructor or <code>@task</code> decorated function. Enables parameterization of tasks (e.g., selecting dataset subsets, configuring difficulty levels).</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="11" data-code-annotation="7"><strong>Sandbox environment</strong> — Maps to Inspect AI <code>Task.sandbox</code>. Can be a string (<code>"docker"</code>, <code>"local"</code>), a tuple with additional config, or a <code>SandboxEnvironmentType</code> object.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="12" data-code-annotation="8"><strong>Sample selection</strong> — Evaluate specific samples from the dataset. Accepts a single ID (<code>sample_id=0</code>), list of IDs (<code>sample_id=[0, 1, 2]</code>), or list of string IDs.</span>
</dd>
</dl>
</section>
<section id="model-specification" class="level3">
<h3 class="anchored" data-anchor-id="model-specification">Model Specification</h3>
<p>Models can be specified as simple strings or as <code>FlowModel</code> objects for more control:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Simple string</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">FlowModel</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Multi-model tasks</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>For simple use cases:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>FlowTask(name<span class="op">=</span><span class="st">"task"</span>, model<span class="op">=</span><span class="st">"openai/gpt-5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>For advanced config:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow.types <span class="im">import</span> FlowModel, FlowGenerateConfig</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"task"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>FlowModel(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            reasoning_effort<span class="op">=</span><span class="st">"medium"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            max_connections<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        base_url<span class="op">=</span><span class="st">"https://custom-endpoint.com"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        api_key<span class="op">=</span><span class="st">"$</span><span class="sc">{CUSTOM_API_KEY}</span><span class="st">"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>For agent evaluations with multiple roles:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"multi_agent_task"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    model_roles<span class="op">=</span>{</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"assistant"</span>: <span class="st">"openai/gpt-5"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"critic"</span>: <span class="st">"anthropic/claude-3-5-sonnet"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to use FlowModel
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>FlowModel</code> when you need to:</p>
<ul>
<li>Set model-specific generation configs</li>
<li>Use custom API endpoints</li>
<li>Configure API keys per model</li>
<li>Organize complex multi-model setups</li>
</ul>
</div>
</div>
</section>
</section>
<section id="dependency-management" class="level2">
<h2 class="anchored" data-anchor-id="dependency-management">Dependency Management</h2>
<p>Inspect Flow automatically creates isolated virtual environments for each workflow run, ensuring repeatability and avoiding dependency conflicts with your system Python environment.</p>
<section id="how-virtual-environments-work" class="level3">
<h3 class="anchored" data-anchor-id="how-virtual-environments-work">How Virtual Environments Work</h3>
<p>When you run <code>flow run config.py</code>, Flow:</p>
<ol type="1">
<li>Creates a temporary virtual environment in <code>~/.cache/inspect-flow/</code> with <a href="https://github.com/astral-sh/uv"><code>uv</code></a></li>
<li>Installs your specified dependencies plus auto-detected model provider packages</li>
<li>Executes your evaluations in this isolated environment</li>
<li>Cleans up the temporary environment after completion (logs persist in <code>flow_dir</code>)</li>
</ol>
</section>
<section id="specifying-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="specifying-dependencies">Specifying Dependencies</h3>
<p>The <code>dependencies</code> field in <code>FlowJob</code> accepts multiple types of package specifiers:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">PyPI Packages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Git Repositories</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Local Packages</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"inspect-evals"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pandas==2.0.0"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Standard PyPI package names with optional version specifiers.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"git+https://github.com/UKGovernmentBEIS/inspect_evals@ef181cd"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Install directly from Git repositories. Use <code>@commit_hash</code> to pin to specific versions for repeatability.</p>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"./my_custom_eval"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../shared/utils"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Install local packages using relative or absolute paths.</p>
</div>
</div>
</div>
</section>
<section id="python-version-control" class="level3">
<h3 class="anchored" data-anchor-id="python-version-control">Python Version Control</h3>
<p>Specify the Python version for your job’s virtual environment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    python_version<span class="op">=</span><span class="st">"3.11"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Checking Python Version
</div>
</div>
<div class="callout-body-container callout-body">
<p>To verify which Python version will be used, run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows the resolved configuration including the Python version that will be used.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Repeatability Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<p>For repeatable workflows:</p>
<ul>
<li>Pin PyPI package versions: <code>"inspect-evals==0.3.15"</code></li>
<li>Pin Git commits: <code>"git+https://github.com/user/repo@commit_hash"</code></li>
<li>Specify <code>python_version</code> explicitly</li>
</ul>
</div>
</div>
</section>
</section>
<section id="defaults-and-overrides" class="level2">
<h2 class="anchored" data-anchor-id="defaults-and-overrides">Defaults and Overrides</h2>
<p>Inspect Flow provides a powerful defaults system to avoid repetition when configuring evaluations. The <code>FlowDefaults</code> field lets you set default values that cascade across tasks, models, solvers, and agents—with more specific settings overriding less specific ones.</p>
<section id="the-flowdefaults-system" class="level3">
<h3 class="anchored" data-anchor-id="the-flowdefaults-system">The FlowDefaults System</h3>
<p><code>FlowDefaults</code> supports multiple levels of default configuration:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-5"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowDefaults, FlowGenerateConfig, FlowModel</span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>    defaults<span class="op">=</span>FlowDefaults(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-5" class="code-annotation-target"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>            max_connections<span class="op">=</span><span class="dv">10</span>,</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-8" class="code-annotation-target"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>FlowModel(</span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>            model_args<span class="op">=</span>{<span class="st">"arg"</span>: <span class="st">"foo"</span>},</span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-11" class="code-annotation-target"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a>        model_prefix<span class="op">=</span>{</span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"openai/"</span>: FlowModel(</span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a>                    max_connections<span class="op">=</span><span class="dv">20</span></span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="annotated-cell-5-16"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="annotated-cell-5-17"><a href="#annotated-cell-5-17" aria-hidden="true" tabindex="-1"></a>        },</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="4">4</button><span id="annotated-cell-5-18" class="code-annotation-target"><a href="#annotated-cell-5-18" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span>FlowSolver(...),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="5">5</button><span id="annotated-cell-5-19" class="code-annotation-target"><a href="#annotated-cell-5-19" aria-hidden="true" tabindex="-1"></a>        solver_prefix<span class="op">=</span>{<span class="st">"chain_of_thought"</span>: ...},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="6">6</button><span id="annotated-cell-5-20" class="code-annotation-target"><a href="#annotated-cell-5-20" aria-hidden="true" tabindex="-1"></a>        agent<span class="op">=</span>FlowAgent(...),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="7">7</button><span id="annotated-cell-5-21" class="code-annotation-target"><a href="#annotated-cell-5-21" aria-hidden="true" tabindex="-1"></a>        agent_prefix<span class="op">=</span>{<span class="st">"inspect/"</span>: ...},</span>
<span id="annotated-cell-5-22"><a href="#annotated-cell-5-22" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>FlowTask(...),</span>
<span id="annotated-cell-5-23"><a href="#annotated-cell-5-23" aria-hidden="true" tabindex="-1"></a>        task_prefix<span class="op">=</span>{<span class="st">"inspect_evals/"</span>: ...},</span>
<span id="annotated-cell-5-24"><a href="#annotated-cell-5-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-5-25"><a href="#annotated-cell-5-25" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="annotated-cell-5-26"><a href="#annotated-cell-5-26" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="5,6,7" data-code-annotation="1">Default model generation options. Will be overriden by settings on the FlowModel and FlowTask.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="8,9,10" data-code-annotation="2">Field defaults for models.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="11,12,13,14,15,16,17" data-code-annotation="3">Model defaults for model name prefixes. Overrides <code>FlowDefaults.config</code> and <code>FlowDefaults.model</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="18" data-code-annotation="4">Field defaults for solvers.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="19" data-code-annotation="5">Solver defaults for solver name prefixes. Overrides <code>FlowDefaults.solver</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="20" data-code-annotation="6">Field defaults for tasks.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="21" data-code-annotation="7">Task defaults for task name prefixes. Overrides <code>FlowDefaults.config</code> and <code>FlowDefaults.task</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
</dl>
</section>
<section id="merge-priority-and-behavior" class="level3">
<h3 class="anchored" data-anchor-id="merge-priority-and-behavior">Merge Priority and Behavior</h3>
<p>Defaults follow a clear hierarchy where <strong>more specific settings override less specific ones</strong>:</p>
<p><strong>For Models:</strong></p>
<ol type="1">
<li>Global config defaults (<code>defaults.config</code>)</li>
<li>Global model defaults (<code>defaults.model</code>)</li>
<li>Model prefix defaults (<code>defaults.model_prefix</code>)</li>
<li>Task-specific config (<code>task.config</code>)</li>
<li>Model-specific config (<code>model.config</code>) — <strong>highest priority</strong></li>
</ol>
<p><strong>Example hierarchy in action:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-6"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>    defaults<span class="op">=</span>FlowDefaults(</span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-4" class="code-annotation-target"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>        model_prefix<span class="op">=</span>{</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"openai/"</span>: FlowModel(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-9" class="code-annotation-target"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"task"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-16" class="code-annotation-target"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.7</span>),</span>
<span id="annotated-cell-6-17"><a href="#annotated-cell-6-17" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>FlowModel(</span>
<span id="annotated-cell-6-18"><a href="#annotated-cell-6-18" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-19" class="code-annotation-target"><a href="#annotated-cell-6-19" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="annotated-cell-6-20"><a href="#annotated-cell-6-20" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="annotated-cell-6-21"><a href="#annotated-cell-6-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="annotated-cell-6-22"><a href="#annotated-cell-6-22" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="annotated-cell-6-23"><a href="#annotated-cell-6-23" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="4,5" data-code-annotation="1">Global defaults: <code>temperature=0.0, max_tokens=100</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="9" data-code-annotation="2">Prefix defaults override: <code>temperature=0.5</code> (for OpenAI models)</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="16" data-code-annotation="3">Task config overrides: <code>temperature=0.7</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="19" data-code-annotation="4"><strong>Model config wins</strong>: <code>temperature=1.0, max_tokens=100</code></span>
</dd>
</dl>
<p><strong>Final result:</strong> <code>temperature=1.0</code> (most specific), <code>max_tokens=100</code> (from global defaults)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>None Values Don’t Override
</div>
</div>
<div class="callout-body-container callout-body">
<p>Setting a field to <code>None</code> means “not specified” — it won’t override existing values from defaults. This allows partial configs to merge cleanly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>, max_tokens<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>max_tokens=None</code> doesn’t override a default <code>max_tokens</code> value; it’s simply not set at this level.</p>
</div>
</div>
</section>
<section id="cli-overrides" class="level3">
<h3 class="anchored" data-anchor-id="cli-overrides">CLI Overrides</h3>
<p>Override config values at runtime using the <code>--set</code> flag:</p>
<p><strong>Basic usage:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> flow_dir=./custom_logs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Nested paths:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> options.limit=10</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> defaults.solver.args.tool_calls=none</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>JSON dicts:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> <span class="st">'options.metadata={"experiment": "baseline", "version": "v1"}'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Multiple overrides:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="dt">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> flow_dir=./logs/experiment1 <span class="dt">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> options.limit=100 <span class="dt">\</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> defaults.config.temperature=0.5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Override Behavior
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Strings</strong>: Replace existing values</li>
<li><strong>Dicts</strong>: Replace existing values</li>
<li><strong>Lists</strong>:
<ul>
<li>String values append to existing list</li>
<li>Lists replace existing list</li>
</ul></li>
</ul>
<p><strong>Examples:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appends to list</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--set</span> dependencies=new_package</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replaces list</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">--set</span> <span class="st">'dependencies=["pkg1", "pkg2"]'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="environment-variables">Environment Variables</h3>
<p>Set config values via environment variables:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_DIR</span><span class="op">=</span>./logs/custom</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_LIMIT</span><span class="op">=</span>50</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Supported environment variables:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Equivalent Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>INSPECT_FLOW_DIR</code></td>
<td><code>--flow-dir</code></td>
<td>Override log directory</td>
</tr>
<tr class="even">
<td><code>INSPECT_FLOW_LIMIT</code></td>
<td><code>--limit</code></td>
<td>Limit number of samples</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Override Priority
</div>
</div>
<div class="callout-body-container callout-body">
<p>Setting defaults via the command line will override the defaults which in turn might be overridden by anything set explicitly.</p>
<p>Dedicated environment variables (see <strong>Supported environment variables</strong> above) and corresponding CLI flags will override the <code>--set</code> flag.</p>
<p>Dedicated CLI flags have the highest priority.</p>
<p>Priority order of <code>flow-dir</code> and <code>limit</code>:</p>
<ol type="1">
<li>FlowJob defaults</li>
<li>Explicit setting on the FlowJob</li>
<li>CLI <code>--set</code> flags</li>
<li>Environment variables</li>
<li>Explitic <code>--flow-dir</code> and <code>--limit</code> CLI flags</li>
</ol>
<p>All other settings follow the priority order:</p>
<ol type="1">
<li>FlowJob defaults</li>
<li>Explicit setting on the FlowJob</li>
<li>CLI <code>--set</code> flags</li>
</ol>
</div>
</div>
</section>
<section id="debugging-defaults-resolution" class="level3">
<h3 class="anchored" data-anchor-id="debugging-defaults-resolution">Debugging Defaults Resolution</h3>
<p>To see the fully resolved configuration with all defaults applied:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows exactly what settings each task will use after applying all defaults and overrides.</p>
</section>
</section>
<section id="parameter-sweeping" class="level2">
<h2 class="anchored" data-anchor-id="parameter-sweeping">Parameter Sweeping</h2>
<p>Parameter sweeping lets you systematically explore evaluation configurations by generating Cartesian products of parameters. Instead of manually writing every combination, Flow provides matrix and “with” functions to declaratively generate evaluation grids.</p>
<section id="matrix-functions-cartesian-products" class="level3">
<h3 class="anchored" data-anchor-id="matrix-functions-cartesian-products">Matrix Functions (Cartesian Products)</h3>
<p>Matrix functions generate all combinations of their parameters using Cartesian products.</p>
<section id="tasks_matrix" class="level4">
<h4 class="anchored" data-anchor-id="tasks_matrix">tasks_matrix()</h4>
<p>Generate task configurations by combining tasks with models, configs, solvers, and arguments:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, tasks_matrix</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/gpqa_diamond"</span>, <span class="st">"inspect_evals/mmlu_0_shot"</span>],</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"anthropic/claude-3-5-sonnet"</span>],</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>4 tasks</strong> (2 tasks × 2 models).</p>
<p><strong>Available parameters:</strong></p>
<ul>
<li><code>task</code>: Single task or list of tasks (required)</li>
<li><code>model</code>: Single model or list of models</li>
<li><code>config</code>: List of <code>FlowGenerateConfig</code> objects</li>
<li><code>solver</code>: List of solvers</li>
<li><code>args</code>: List of argument dictionaries for task constructors</li>
<li><code>model_roles</code>: List of role-to-model mappings (for multi-model tasks)</li>
</ul>
</section>
<section id="models_matrix" class="level4">
<h4 class="anchored" data-anchor-id="models_matrix">models_matrix()</h4>
<p>Generate model configurations with different generation settings:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowGenerateConfig, tasks_matrix, models_matrix</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>models_matrix(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"openai/gpt-4o-mini"</span>],</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>[</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.0</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>6 tasks</strong> (1 task × 2 models × 3 temperatures).</p>
</section>
<section id="configs_matrix" class="level4">
<h4 class="anchored" data-anchor-id="configs_matrix">configs_matrix()</h4>
<p>Generate generation config combinations by specifying individual parameters:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, tasks_matrix, models_matrix, configs_matrix</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>models_matrix(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"openai/gpt-4o-mini"</span>],</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>configs_matrix(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>],</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span>[<span class="dv">1000</span>, <span class="dv">2000</span>],</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>12 tasks</strong> (1 task × 2 models × 3 temperatures × 2 max_tokens).</p>
</section>
<section id="solvers_matrix-and-agents_matrix" class="level4">
<h4 class="anchored" data-anchor-id="solvers_matrix-and-agents_matrix">solvers_matrix() and agents_matrix()</h4>
<p>Generate solver or agent configurations with different arguments:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, tasks_matrix, solvers_matrix</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"my_task"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span>solvers_matrix(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>            solver<span class="op">=</span><span class="st">"chain_of_thought"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            args<span class="op">=</span>[</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">3</span>},</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">5</span>},</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">10</span>},</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>3 tasks</strong> (1 task × 3 solver configurations).</p>
</section>
</section>
<section id="with-functions-apply-to-all" class="level3">
<h3 class="anchored" data-anchor-id="with-functions-apply-to-all">With Functions (Apply to All)</h3>
<p>“With” functions apply the same value to all items in a list. Use these when you want to sweep over some parameters while keeping others constant.</p>
<section id="tasks_with" class="level4">
<h4 class="anchored" data-anchor-id="tasks_with">tasks_with()</h4>
<p>Apply common settings to multiple tasks:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowGenerateConfig, tasks_with</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_with(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/gpqa_diamond"</span>, <span class="st">"inspect_evals/mmlu_0_shot"</span>],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,  <span class="co"># Same model for both tasks</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.7</span>),  <span class="co"># Same config for both</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>2 tasks</strong> (2 tasks, each with the same model and config).</p>
</section>
<section id="combining-matrix-and-with" class="level4">
<h4 class="anchored" data-anchor-id="combining-matrix-and-with">Combining Matrix and With</h4>
<p>Mix parameter sweeps with common settings:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowGenerateConfig, tasks_with, tasks_matrix, configs_matrix</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_with(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>tasks_matrix(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            task<span class="op">=</span>[<span class="st">"task1"</span>, <span class="st">"task2"</span>],</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>configs_matrix(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        ),  <span class="co"># Creates 6 tasks (2 × 3)</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,  <span class="co"># Applied to all 6 tasks</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        sandbox<span class="op">=</span><span class="st">"docker"</span>,  <span class="co"># Applied to all 6 tasks</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="nested-sweeps" class="level3">
<h3 class="anchored" data-anchor-id="nested-sweeps">Nested Sweeps</h3>
<p>Matrix functions can be nested to create complex parameter grids. Use the unpacking operator <code>*</code> to expand inner matrix results:</p>
<p><strong>Example: Tasks with nested model sweep</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowGenerateConfig, tasks_matrix, models_matrix</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/mmlu_0_shot"</span>, <span class="st">"inspect_evals/gpqa_diamond"</span>],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"anthropic/claude-3-5-sonnet"</span>,  <span class="co"># Single model</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>models_matrix(  <span class="co"># Unpacks list of 4 model configs</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"openai/gpt-4o-mini"</span>],</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>[</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                    FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"low"</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                    FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"high"</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        ],  <span class="co"># Total: 1 + 4 = 5 models</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>10 tasks</strong> (2 tasks × 5 model configurations).</p>
<p><strong>Example: Tasks with nested task sweep</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask, tasks_matrix</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>            FlowTask(name<span class="op">=</span><span class="st">"task1"</span>, args<span class="op">=</span>{<span class="st">"subset"</span>: <span class="st">"test"</span>}),  <span class="co"># Single task</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>tasks_matrix(  <span class="co"># Unpacks list of 3 tasks</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                task<span class="op">=</span><span class="st">"task2"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                args<span class="op">=</span>[</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"en"</span>},</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"de"</span>},</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"fr"</span>},</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        ],  <span class="co"># Total: 1 + 3 = 4 tasks</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[<span class="st">"model1"</span>, <span class="st">"model2"</span>],</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates <strong>8 tasks</strong> (4 task variants × 2 models).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Watch Out for Combinatorial Explosion
</div>
</div>
<div class="callout-body-container callout-body">
<p>Parameter sweeps grow multiplicatively. A sweep with: - 3 tasks - 4 models - 5 temperature values - 3 solver configurations</p>
<p>Results in 3 × 4 × 5 × 3 = <strong>180 evaluations</strong>.</p>
<p>Always use <code>--dry-run</code> to check the number of evaluations before running expensive grids.</p>
</div>
</div>
</section>
<section id="config-merging-behavior" class="level3">
<h3 class="anchored" data-anchor-id="config-merging-behavior">Config Merging Behavior</h3>
<p>When base objects already have values, matrix parameters are merged:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Config fields merge recursively</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>tasks_matrix(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    task<span class="op">=</span>FlowTask(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"task"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Base value</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>[</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        FlowGenerateConfig(max_tokens<span class="op">=</span><span class="dv">1000</span>),  <span class="co"># Adds max_tokens, keeps temperature=0.5</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        FlowGenerateConfig(max_tokens<span class="op">=</span><span class="dv">2000</span>),  <span class="co"># Adds max_tokens, keeps temperature=0.5</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="running-evaluations" class="level2">
<h2 class="anchored" data-anchor-id="running-evaluations">Running Evaluations</h2>
<p>Once you’ve defined your Flow configuration, you can execute evaluations using the <code>flow run</code> command. Flow also provides tools for previewing configurations and controlling runtime behavior.</p>
<section id="the-flow-run-command" class="level3">
<h3 class="anchored" data-anchor-id="the-flow-run-command">The flow run Command</h3>
<p>Execute your evaluation workflow:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What happens when you run this:</strong></p>
<ol type="1">
<li>Flow loads your configuration file</li>
<li>Creates an isolated virtual environment in <code>~/.cache/inspect-flow/</code></li>
<li>Installs dependencies</li>
<li>Resolves all defaults and matrix expansions</li>
<li>Executes evaluations via Inspect AI’s <code>eval_set()</code></li>
<li>Stores logs in <code>flow_dir</code> (default: <code>logs/flow/</code>)</li>
<li>Cleans up the temporary environment</li>
</ol>
<section id="common-cli-flags" class="level4">
<h4 class="anchored" data-anchor-id="common-cli-flags">Common CLI Flags</h4>
<p><strong>Preview without running:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--dry-run</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Shows how many tasks would be executed without actually running them. Useful for validating large parameter sweeps.</p>
<pre><code>eval_set would be called with 24 tasks</code></pre>
<p><strong>Limit samples for testing:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--limit</span> 10</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Only evaluates the first 10 samples per task. Perfect for quick testing before running expensive evaluations.</p>
<p><strong>Override log directory:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--flow-dir</span> ./experiments/baseline</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Changes where logs and results are stored.</p>
<p><strong>Runtime overrides:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="dt">\</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> options.limit=100 <span class="dt">\</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> defaults.config.temperature=0.5 <span class="dt">\</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> flow_dir=./logs/experiment1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Override any configuration value at runtime. See <a href="#cli-overrides">CLI Overrides</a> for more details.</p>
</section>
</section>
<section id="the-flow-config-command" class="level3">
<h3 class="anchored" data-anchor-id="the-flow-config-command">The flow config Command</h3>
<p>Preview your configuration before running:</p>
<p><strong>Basic usage:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Displays the parsed configuration as YAML with CLI overrides applied. Does not create a virtual environment or instantiate Python objects.</p>
<p><strong>Full resolution:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Shows the completely resolved configuration: - Creates virtual environment - Applies all defaults - Expands all matrix functions - Instantiates all Python objects</p>
<p>This is invaluable for debugging what settings will actually be used in your evaluations.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Use Each Command
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong><code>flow config</code></strong> - Quick syntax check, verify overrides</li>
<li><strong><code>flow config --resolve</code></strong> - Debug defaults resolution, inspect final settings</li>
<li><strong><code>flow run --dry-run</code></strong> - Count tasks in parameter sweeps, validate before expensive runs</li>
<li><strong><code>flow run</code></strong> - Execute evaluations</li>
</ul>
</div>
</div>
</section>
<section id="results-and-logs" class="level3">
<h3 class="anchored" data-anchor-id="results-and-logs">Results and Logs</h3>
<section id="flow-directory-structure" class="level4">
<h4 class="anchored" data-anchor-id="flow-directory-structure">Flow Directory Structure</h4>
<p>Evaluation results are stored in the <code>flow_dir</code> (default: <code>logs/flow/</code>):</p>
<pre><code>logs/flow/
├── logs/
│   ├── 2025-11-11T10-44-39+01-00_gpqa-diamond_XuAMHBzFSPgCE5M6mDzuBM.eval
│   ├── 2025-11-11T10-44-39+01-00_mmlu-0-shot_Vnu2A3M2wPet5yobLiCQmZ.eval
│   └── ...
└── 2025-11-11T10-44-39+01-00_flow.yaml</code></pre>
<p><strong>Directory structure:</strong></p>
<ul>
<li>Flow controls the <code>flow_dir</code> path and passes <code>{flow_dir}/logs/</code> to Inspect AI</li>
<li>Inspect AI handles the actual evaluation log file naming and storage</li>
<li>Log file naming conventions follow Inspect AI’s standards (see <a href="https://inspect.aisi.org.uk/eval-logs.html#log-file-name">Inspect AI logging docs</a>)</li>
<li>Flow automatically saves the resolved configuration before execution as <code>{timestamp}_flow.yaml</code></li>
</ul>
<p><strong>Log formats:</strong></p>
<ul>
<li><code>.eval</code> - Binary Inspect AI log format (default, high-performance)</li>
<li><code>.json</code> - JSON format (if <code>log_format="json"</code> in FlowOptions)</li>
</ul>
</section>
<section id="viewing-results" class="level4">
<h4 class="anchored" data-anchor-id="viewing-results">Viewing Results</h4>
<p><strong>Using Inspect View:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">inspect</span> view</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Opens the Inspect AI viewer to explore evaluation logs interactively.</p>
</section>
<section id="s3-support" class="level4">
<h4 class="anchored" data-anchor-id="s3-support">S3 Support</h4>
<p>Store logs directly to S3:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    flow_dir<span class="op">=</span><span class="st">"s3://my-bucket/experiments/baseline"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
</section>
<section id="advanced-features" class="level2">
<h2 class="anchored" data-anchor-id="advanced-features">Advanced Features</h2>
<section id="metadata-management" class="level3">
<h3 class="anchored" data-anchor-id="metadata-management">Metadata Management</h3>
<p>Flow supports two types of metadata with distinct purposes: <code>metadata</code> and <code>flow_metadata</code>.</p>
<section id="metadata-inspect-ai-metadata" class="level4">
<h4 class="anchored" data-anchor-id="metadata-inspect-ai-metadata">metadata (Inspect AI Metadata)</h4>
<p>The <code>metadata</code> field in <code>FlowOptions</code> and <code>FlowTask</code> is passed directly to Inspect AI and stored in evaluation logs. Use this for tracking experiment information that should be accessible in Inspect AI’s log viewer and analysis tools.</p>
<p><strong>Example:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow.types <span class="im">import</span> FlowJob, FlowTask, FlowOptions</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">=</span>{</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"experiment"</span>: <span class="st">"baseline_v1"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"hypothesis"</span>: <span class="st">"Higher temperature improves creative tasks"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"hardware"</span>: <span class="st">"A100-80GB"</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span>{</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"task_variant"</span>: <span class="st">"chemistry_subset"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"note"</span>: <span class="st">"Testing with reduced context"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The metadata from <code>FlowOptions</code> is applied globally to all tasks in the evaluation run, while task-level metadata is specific to each task.</p>
</section>
<section id="flow_metadata-flow-only-metadata" class="level4">
<h4 class="anchored" data-anchor-id="flow_metadata-flow-only-metadata">flow_metadata (Flow-Only Metadata)</h4>
<p>The <code>flow_metadata</code> field is available on <code>FlowJob</code>, <code>FlowTask</code>, <code>FlowModel</code>, <code>FlowSolver</code>, and <code>FlowAgent</code>. This metadata is <strong>not passed to Inspect AI</strong>—it exists only in the Flow configuration and is useful for configuration-time logic and organization.</p>
<p><strong>Use cases:</strong></p>
<ul>
<li>Filtering or selecting configurations based on properties</li>
<li>Organizing complex configuration generation logic</li>
<li>Documenting configuration decisions</li>
<li>Annotating configs without polluting Inspect AI logs</li>
</ul>
<p><strong>Example: Configuration-time filtering</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowModel, tasks_matrix</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define models with metadata about capabilities</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    FlowModel(<span class="st">"openai/gpt-4o"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">128000</span>}),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    FlowModel(<span class="st">"openai/gpt-4o-mini"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">128000</span>}),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    FlowModel(<span class="st">"anthropic/claude-3-5-sonnet"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">200000</span>}),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to only long-context models</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>long_context_models <span class="op">=</span> [</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    m <span class="cf">for</span> m <span class="kw">in</span> models</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m.flow_metadata <span class="kw">and</span> m.flow_metadata.get(<span class="st">"context_window"</span>, <span class="dv">0</span>) <span class="op">&gt;=</span> <span class="dv">128000</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"long_context_task"</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>long_context_models,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/meridianlabs-ai\.github\.io\/inspect_flow");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            trigger: 'click',
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            positionFixed: true,
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html#basic-examples" class="pagination-link" aria-label="Basic Examples">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Basic Examples</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./usage.html#core-concepts" class="pagination-link" aria-label="Core Concepts">
        <span class="nav-page-text">Core Concepts</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/">
<p>Meridian Labs</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow">
<p>Code</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow/blob/main/LICENSE">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow/issues">
<p>Issues</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/meridianlabs-ai/inspect_flow/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow">
<p>Code</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>