<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Flow – Inspect Flow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./usage.qmd#core-concepts" rel="next">
<link href="./index.qmd#basic-examples" rel="prev">
<link href="./images/icon-dark.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-788bc0b29e91bf580540fd01d9d6612c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Inspect Flow">
<meta property="og:description" content="Workflow orchestration for Inspect AI">
<meta property="og:image" content="https://meridianlabs-ai.github.io/inspect_flow/images/first_config_progress_terminal.png">
<meta property="og:site_name" content="Inspect Flow">
<meta property="og:image:height" content="215">
<meta property="og:image:width" content="2098">
<meta name="twitter:title" content="Inspect Flow">
<meta name="twitter:description" content="Workflow orchestration for Inspect AI">
<meta name="twitter:image" content="https://meridianlabs-ai.github.io/inspect_flow/images/first_config_progress_terminal.png">
<meta name="twitter:image-height" content="215">
<meta name="twitter:image-width" content="2098">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/icon-dark.svg" alt="" class="navbar-logo light-content">
    <img src="./images/icon-dark.svg" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Inspect Flow</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./usage.html"> 
<span class="menu-text">Usage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./usage.html">Using Flow</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#introduction" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#getting-started" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html#basic-examples" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./usage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Using Flow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#core-concepts" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#creating-flow-configs" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating Flow Configs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#dependency-management" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dependency Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#defaults-and-overrides" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Defaults and Overrides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#configuration-inheritance" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuration Inheritance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#parameter-sweeping" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parameter Sweeping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#running-evaluations" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Running Evaluations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./usage.html#advanced-features" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Features</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#core-concepts" id="toc-core-concepts" class="nav-link active" data-scroll-target="#core-concepts">Core Concepts</a>
  <ul class="collapse">
  <li><a href="#flow-type-system" id="toc-flow-type-system" class="nav-link" data-scroll-target="#flow-type-system">Flow Type System</a></li>
  <li><a href="#flow-config-structure" id="toc-flow-config-structure" class="nav-link" data-scroll-target="#flow-config-structure">Flow Config Structure</a></li>
  </ul></li>
  <li><a href="#creating-flow-configs" id="toc-creating-flow-configs" class="nav-link" data-scroll-target="#creating-flow-configs">Creating Flow Configs</a>
  <ul class="collapse">
  <li><a href="#your-first-config" id="toc-your-first-config" class="nav-link" data-scroll-target="#your-first-config">Your First Config</a></li>
  <li><a href="#task-specification" id="toc-task-specification" class="nav-link" data-scroll-target="#task-specification">Task Specification</a></li>
  <li><a href="#task-configuration" id="toc-task-configuration" class="nav-link" data-scroll-target="#task-configuration">Task Configuration</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  </ul></li>
  <li><a href="#dependency-management" id="toc-dependency-management" class="nav-link" data-scroll-target="#dependency-management">Dependency Management</a>
  <ul class="collapse">
  <li><a href="#how-virtual-environments-work" id="toc-how-virtual-environments-work" class="nav-link" data-scroll-target="#how-virtual-environments-work">How Virtual Environments Work</a></li>
  <li><a href="#specifying-dependencies" id="toc-specifying-dependencies" class="nav-link" data-scroll-target="#specifying-dependencies">Specifying Dependencies</a></li>
  <li><a href="#python-version-control" id="toc-python-version-control" class="nav-link" data-scroll-target="#python-version-control">Python Version Control</a></li>
  </ul></li>
  <li><a href="#defaults-and-overrides" id="toc-defaults-and-overrides" class="nav-link" data-scroll-target="#defaults-and-overrides">Defaults and Overrides</a>
  <ul class="collapse">
  <li><a href="#the-flowdefaults-system" id="toc-the-flowdefaults-system" class="nav-link" data-scroll-target="#the-flowdefaults-system">The FlowDefaults System</a></li>
  <li><a href="#merge-priority-and-behavior" id="toc-merge-priority-and-behavior" class="nav-link" data-scroll-target="#merge-priority-and-behavior">Merge Priority and Behavior</a></li>
  <li><a href="#cli-overrides" id="toc-cli-overrides" class="nav-link" data-scroll-target="#cli-overrides">CLI Overrides</a></li>
  <li><a href="#environment-variables" id="toc-environment-variables" class="nav-link" data-scroll-target="#environment-variables">Environment Variables</a></li>
  <li><a href="#debugging-defaults-resolution" id="toc-debugging-defaults-resolution" class="nav-link" data-scroll-target="#debugging-defaults-resolution">Debugging Defaults Resolution</a></li>
  </ul></li>
  <li><a href="#configuration-inheritance" id="toc-configuration-inheritance" class="nav-link" data-scroll-target="#configuration-inheritance">Configuration Inheritance</a>
  <ul class="collapse">
  <li><a href="#explicit-includes" id="toc-explicit-includes" class="nav-link" data-scroll-target="#explicit-includes">Explicit Includes</a></li>
  <li><a href="#automatic-discovery" id="toc-automatic-discovery" class="nav-link" data-scroll-target="#automatic-discovery">Automatic Discovery</a></li>
  </ul></li>
  <li><a href="#parameter-sweeping" id="toc-parameter-sweeping" class="nav-link" data-scroll-target="#parameter-sweeping">Parameter Sweeping</a>
  <ul class="collapse">
  <li><a href="#matrix-functions-cartesian-products" id="toc-matrix-functions-cartesian-products" class="nav-link" data-scroll-target="#matrix-functions-cartesian-products">Matrix Functions (Cartesian Products)</a></li>
  <li><a href="#with-functions-apply-to-all" id="toc-with-functions-apply-to-all" class="nav-link" data-scroll-target="#with-functions-apply-to-all">With Functions (Apply to All)</a></li>
  <li><a href="#nested-sweeps" id="toc-nested-sweeps" class="nav-link" data-scroll-target="#nested-sweeps">Nested Sweeps</a></li>
  <li><a href="#config-merging-behavior" id="toc-config-merging-behavior" class="nav-link" data-scroll-target="#config-merging-behavior">Config Merging Behavior</a></li>
  </ul></li>
  <li><a href="#running-evaluations" id="toc-running-evaluations" class="nav-link" data-scroll-target="#running-evaluations">Running Evaluations</a>
  <ul class="collapse">
  <li><a href="#the-flow-run-command" id="toc-the-flow-run-command" class="nav-link" data-scroll-target="#the-flow-run-command">The <code>flow run</code> Command</a></li>
  <li><a href="#the-flow-config-command" id="toc-the-flow-config-command" class="nav-link" data-scroll-target="#the-flow-config-command">The <code>flow config</code> Command</a></li>
  <li><a href="#results-and-logs" id="toc-results-and-logs" class="nav-link" data-scroll-target="#results-and-logs">Results and Logs</a></li>
  </ul></li>
  <li><a href="#advanced-features" id="toc-advanced-features" class="nav-link" data-scroll-target="#advanced-features">Advanced Features</a>
  <ul class="collapse">
  <li><a href="#metadata-management" id="toc-metadata-management" class="nav-link" data-scroll-target="#metadata-management">Metadata Management</a></li>
  <li><a href="#variable-substitution" id="toc-variable-substitution" class="nav-link" data-scroll-target="#variable-substitution">Variable Substitution</a></li>
  <li><a href="#bundle-url-mapping" id="toc-bundle-url-mapping" class="nav-link" data-scroll-target="#bundle-url-mapping">Bundle URL Mapping</a></li>
  <li><a href="#configuration-scripts" id="toc-configuration-scripts" class="nav-link" data-scroll-target="#configuration-scripts">Configuration Scripts</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/meridianlabs-ai/inspect_flow/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Flow</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="core-concepts" class="level2">
<h2 class="anchored" data-anchor-id="core-concepts">Core Concepts</h2>
<section id="flow-type-system" class="level3">
<h3 class="anchored" data-anchor-id="flow-type-system">Flow Type System</h3>
<p>Inspect Flow mirrors Inspect AI’s object model with corresponding Flow types:</p>
<ul>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span></strong> — The top-level job definition. Under the hood it translates to an Inspect AI <a href="https://inspect.aisi.org.uk/eval-sets.html">Eval Set</a>. Contains a list of tasks and job settings.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowtask">FlowTask</a></span></strong> — Configuration for a single evaluation task. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/tasks.html">Task</a> parameters.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowmodel">FlowModel</a></span></strong> — Model configuration including API settings and generation settings. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/models.html">Model</a>.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowgenerateconfig">FlowGenerateConfig</a></span></strong> — Model generation parameters. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/models.html#generation-config">GenerateConfig</a>.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowsolver">FlowSolver</a></span></strong> and <strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowagent">FlowAgent</a></span></strong> — Solver and agent chain configuration. Map to Inspect AI <a href="https://inspect.aisi.org.uk/solvers.html">Solver</a> and <a href="https://inspect.aisi.org.uk/agents.html">Agent</a>.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowoptions">FlowOptions</a></span></strong> — Runtime execution options. Maps to Inspect AI <a href="https://inspect.aisi.org.uk/eval-sets.html">eval_set()</a> parameters.</li>
<li><strong><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowdefaults">FlowDefaults</a></span></strong> — System for setting default values across tasks, models, solvers, and agents.</li>
</ul>
</section>
<section id="flow-config-structure" class="level3">
<h3 class="anchored" data-anchor-id="flow-config-structure">Flow Config Structure</h3>
<p><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span> is the primary interface for defining Flow workflows. All Flow operations—including <a href="#parameter-sweeping">parameter sweeps and matrix expansions</a>—ultimately produce a list of tasks that <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span> executes.</p>
<p><strong>Required fields:</strong></p>
<ul>
<li><strong><code>log_dir</code></strong> — Output path for logging results. Must be set before running the flow job. Supports S3 paths (e.g., <code>s3://bucket/path</code>)</li>
</ul>
<p><strong>Optional fields:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tasks</code></td>
<td>List of <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowtask">FlowTask</a></span> objects defining the evaluations to run</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>includes</code></td>
<td>List of other flow configs to include (paths as strings or <code>FlowInclude</code> objects)</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>log_dir_create_unique</code></td>
<td>If <code>True</code>, append numeric suffix to <code>log_dir</code> if it exists. If <code>False</code>, reuse existing directory (must be empty or have <code>log_dir_allow_dirty=True</code>)</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>python_version</code></td>
<td>Python version for the isolated virtual environment (e.g., <code>"3.11"</code>)</td>
<td>Same as current environment</td>
</tr>
<tr class="odd">
<td><code>dependencies</code></td>
<td>PyPI packages, Git URLs, or local paths to install</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>env</code></td>
<td>Environment variables to set when running tasks</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>options</code></td>
<td>Runtime options (see <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowoptions">FlowOptions</a></span> reference)</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>defaults</code></td>
<td>Default values applied across tasks, models, and solvers</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>flow_metadata</code></td>
<td>Metadata stored in the flow config (not passed to Inspect AI)</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="creating-flow-configs" class="level2">
<h2 class="anchored" data-anchor-id="creating-flow-configs">Creating Flow Configs</h2>
<section id="your-first-config" class="level3">
<h3 class="anchored" data-anchor-id="your-first-config">Your First Config</h3>
<p>In <a href="./index.html#basic-examples">Basic Examples</a>, we showed a simple <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span>. Let’s break down what’s happening:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>first_config.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-1" data-filename="first_config.py"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-6" class="code-annotation-target"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-8" class="code-annotation-target"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5">5</button><span id="annotated-cell-1-9" class="code-annotation-target"><a href="#annotated-cell-1-9" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="1">Specify the directory for storing logs</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="5" data-code-annotation="2">Install <a href="https://pypi.org/project/inspect-evals/"><code>inspect-evals</code></a> Python package</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="3">List evaluation tasks to run</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="8" data-code-annotation="4">Specify task from registry by name</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="9" data-code-annotation="5">Specify model to evaluate by name</span>
</dd>
</dl>
<p>To run the task, run the following command in your shell.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/first_config_progress_terminal.png" class="img-fluid figure-img"></p>
<figcaption>Progress bar in terminal</figcaption>
</figure>
</div>
<p><strong>What happens when you run this?</strong></p>
<ol type="1">
<li>Flow creates an isolated virtual environment</li>
<li>Installs <code>inspect-evals</code> and <code>openai</code> (inferred from model)</li>
<li>Loads the <code>gpqa_diamond</code> task from the <code>inspect_evals</code> registry</li>
<li>Runs the evaluation with GPT-5</li>
<li>Stores results in <code>logs/</code></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Config File Evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Python config files are evaluated as normal Python code. The last expression in the file is used as the <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span>. This means you can:</p>
<ul>
<li>Define variables and reuse them</li>
<li>Use loops or comprehensions to generate task lists</li>
<li>Import helper functions</li>
<li>Add comments and documentation</li>
</ul>
<p>Flow configs are just Python!</p>
</div>
</div>
</section>
<section id="task-specification" class="level3">
<h3 class="anchored" data-anchor-id="task-specification">Task Specification</h3>
<p>In the example above, we used a registry name (<code>"inspect_evals/gpqa_diamond"</code>). Flow supports multiple ways to reference tasks:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Registry Name</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">File Path</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">File with Function</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasks from installed packages.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-discovers `@task` decorated functions in the specified file and creates a task for each of them.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"./my_task.py"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explicitly selects a specific function from the file.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"./my_task.py@custom_eval"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="task-configuration" class="level3">
<h3 class="anchored" data-anchor-id="task-configuration">Task Configuration</h3>
<p><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowtask">FlowTask</a></span> accepts parameters that map to Inspect AI <a href="https://inspect.aisi.org.uk/tasks.html">Task</a> fields. The examples below show commonly used fields; see the FlowTask reference documentationfor the complete list of available parameters.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"inspect_evals/mmlu_0_shot"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">3</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4">4</button><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>        max_tokens<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="5">5</button><span id="annotated-cell-3-9" class="code-annotation-target"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>    solver<span class="op">=</span><span class="st">"chain_of_thought"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="6">6</button><span id="annotated-cell-3-10" class="code-annotation-target"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a>    args<span class="op">=</span>{<span class="st">"subject"</span>: <span class="st">"physics"</span>},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="7">7</button><span id="annotated-cell-3-11" class="code-annotation-target"><a href="#annotated-cell-3-11" aria-hidden="true" tabindex="-1"></a>    sandbox<span class="op">=</span><span class="st">"docker"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="8">8</button><span id="annotated-cell-3-12" class="code-annotation-target"><a href="#annotated-cell-3-12" aria-hidden="true" tabindex="-1"></a>    sample_id<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="annotated-cell-3-13"><a href="#annotated-cell-3-13" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1"><strong>Task name</strong> — Maps to Inspect AI <code>Task.name</code>. Can be a registry name (<code>"inspect_evals/mmlu"</code>), file path (<code>"./task.py"</code>), or file with function (<code>"./task.py@eval_fn"</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="2"><strong>Model</strong> — Maps to Inspect AI <code>Task.model</code>. Optional model for this task. If not specified, uses the model from <code>INSPECT_EVAL_MODEL</code> environment variable. Can be a string (<code>"openai/gpt-5"</code>) or a <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowmodel">FlowModel</a></span> object for advanced configuration.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="3"><strong>Epochs</strong> — Maps to Inspect AI <code>Task.epochs</code>. Number of times to repeat evaluation over the dataset samples. Can be an integer (<code>epochs=3</code>) or a <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowepochs">FlowEpochs</a></span> object to specify custom reducer functions (<code>FlowEpochs(epochs=3, reducer="median")</code>). By default, scores are combined using the <code>"mean"</code> reducer across epochs.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5,6,7,8" data-code-annotation="4"><strong>Generation config</strong> — Maps to Inspect AI <code>Task.config</code> (<code>GenerateConfig</code>). Model generation parameters like <code>temperature</code>, <code>max_tokens</code>, <code>top_p</code>, <code>reasoning_effort</code>, etc. These settings override config on <code>FlowJob.config</code> but are overridden by settings on <code>FlowModel.config</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="9" data-code-annotation="5"><strong>Solver chain</strong> — Maps to Inspect AI <code>Task.solver</code>. The algorithm(s) for solving the task. Can be a string (<code>"chain_of_thought"</code>), <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowsolver">FlowSolver</a></span> object, <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowagent">FlowAgent</a></span> object, or a list of solvers for chaining. Defaults to <code>generate()</code> if not specified.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="10" data-code-annotation="6"><strong>Task arguments</strong> — Maps to task function parameters. Dictionary of arguments passed to the task constructor or <code>@task</code> decorated function. Enables parameterization of tasks (e.g., selecting dataset subsets, configuring difficulty levels).</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="11" data-code-annotation="7"><strong>Sandbox environment</strong> — Maps to Inspect AI <code>Task.sandbox</code>. Can be a string (<code>"docker"</code>, <code>"local"</code>), a tuple with additional config, or a <code>SandboxEnvironmentType</code> object.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="12" data-code-annotation="8"><strong>Sample selection</strong> — Evaluate specific samples from the dataset. Accepts a single ID (<code>sample_id=0</code>), list of IDs (<code>sample_id=[0, 1, 2]</code>), or list of string IDs.</span>
</dd>
</dl>
</section>
<section id="model-specification" class="level3">
<h3 class="anchored" data-anchor-id="model-specification">Model Specification</h3>
<p>Models can be specified as simple strings or as <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowmodel">FlowModel</a></span> objects for more control:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Simple string</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">FlowModel</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Multi-model tasks</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>FlowTask(name<span class="op">=</span><span class="st">"task"</span>, model<span class="op">=</span><span class="st">"openai/gpt-5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"task"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>FlowModel(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"openai/gpt-5"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            reasoning_effort<span class="op">=</span><span class="st">"medium"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            max_connections<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        base_url<span class="op">=</span><span class="st">"https://custom-endpoint.com"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        api_key<span class="op">=</span><span class="st">"$</span><span class="sc">{CUSTOM_API_KEY}</span><span class="st">"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For agent evaluations with multiple roles</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"multi_agent_task"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    model_roles<span class="op">=</span>{</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"assistant"</span>: <span class="st">"openai/gpt-5"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"critic"</span>: <span class="st">"anthropic/claude-3-5-sonnet"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to use FlowModel
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowmodel">FlowModel</a></span> when you need to:</p>
<ul>
<li>Set model-specific generation configs</li>
<li>Use custom API endpoints</li>
<li>Configure API keys per model</li>
<li>Organize complex multi-model setups</li>
</ul>
</div>
</div>
</section>
</section>
<section id="dependency-management" class="level2">
<h2 class="anchored" data-anchor-id="dependency-management">Dependency Management</h2>
<p>Inspect Flow automatically creates isolated virtual environments for each workflow run, ensuring repeatability and avoiding dependency conflicts with your system Python environment.</p>
<section id="how-virtual-environments-work" class="level3">
<h3 class="anchored" data-anchor-id="how-virtual-environments-work">How Virtual Environments Work</h3>
<p>When you run <code>flow run config.py</code>, Flow:</p>
<ol type="1">
<li>Creates a temporary virtual environment with <a href="https://github.com/astral-sh/uv"><code>uv</code></a></li>
<li>Installs your specified dependencies plus auto-detected model provider packages</li>
<li>Executes your evaluations in this isolated environment</li>
<li>Cleans up the temporary environment after completion (logs persist in <code>log_dir</code>)</li>
</ol>
</section>
<section id="specifying-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="specifying-dependencies">Specifying Dependencies</h3>
<p>The <code>dependencies</code> field in <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span> accepts multiple types of package specifiers:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">PyPI Packages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Git Repositories</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Local Packages</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard PyPI package names with optional version specifiers.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"inspect-evals"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pandas==2.0.0"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install directly from Git repositories. Use `@commit_hash` to pin to specific versions for repeatability.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"git+https://github.com/UKGovernmentBEIS/inspect_evals@ef181cd"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install local packages using relative or absolute paths.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"./my_custom_eval"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../shared/utils"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="python-version-control" class="level3">
<h3 class="anchored" data-anchor-id="python-version-control">Python Version Control</h3>
<p>Specify the Python version for your job’s virtual environment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    python_version<span class="op">=</span><span class="st">"3.11"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Checking Python Version
</div>
</div>
<div class="callout-body-container callout-body">
<p>To verify which Python version will be used, run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows the resolved configuration including the Python version that will be used.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Repeatability Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<p>For repeatable workflows:</p>
<ul>
<li>Pin PyPI package versions: <code>"inspect-evals==0.3.15"</code></li>
<li>Pin Git commits: <code>"git+https://github.com/user/repo@commit_hash"</code></li>
<li>Specify <code>python_version</code> explicitly</li>
</ul>
</div>
</div>
</section>
</section>
<section id="defaults-and-overrides" class="level2">
<h2 class="anchored" data-anchor-id="defaults-and-overrides">Defaults and Overrides</h2>
<p>Inspect Flow provides a powerful defaults system to avoid repetition when configuring evaluations. The <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowdefaults">FlowDefaults</a></span> field lets you set default values that cascade across tasks, models, solvers, and agents—with more specific settings overriding less specific ones.</p>
<section id="the-flowdefaults-system" class="level3">
<h3 class="anchored" data-anchor-id="the-flowdefaults-system">The FlowDefaults System</h3>
<p><span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowdefaults">FlowDefaults</a></span> supports multiple levels of default configuration:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-5"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> (</span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>    FlowJob,</span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>    FlowDefaults,</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>    FlowGenerateConfig,</span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>    FlowModel,</span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>    FlowSolver,</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>    FlowAgent,</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a>    FlowTask,</span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a>    defaults<span class="op">=</span>FlowDefaults(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-13" class="code-annotation-target"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a>            max_connections<span class="op">=</span><span class="dv">10</span>,</span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a>        ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-16" class="code-annotation-target"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>FlowModel(</span>
<span id="annotated-cell-5-17"><a href="#annotated-cell-5-17" aria-hidden="true" tabindex="-1"></a>            model_args<span class="op">=</span>{<span class="st">"arg"</span>: <span class="st">"foo"</span>},</span>
<span id="annotated-cell-5-18"><a href="#annotated-cell-5-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-19" class="code-annotation-target"><a href="#annotated-cell-5-19" aria-hidden="true" tabindex="-1"></a>        model_prefix<span class="op">=</span>{</span>
<span id="annotated-cell-5-20"><a href="#annotated-cell-5-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"openai/"</span>: FlowModel(</span>
<span id="annotated-cell-5-21"><a href="#annotated-cell-5-21" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(</span>
<span id="annotated-cell-5-22"><a href="#annotated-cell-5-22" aria-hidden="true" tabindex="-1"></a>                    max_connections<span class="op">=</span><span class="dv">20</span></span>
<span id="annotated-cell-5-23"><a href="#annotated-cell-5-23" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="annotated-cell-5-24"><a href="#annotated-cell-5-24" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="annotated-cell-5-25"><a href="#annotated-cell-5-25" aria-hidden="true" tabindex="-1"></a>        },</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="4">4</button><span id="annotated-cell-5-26" class="code-annotation-target"><a href="#annotated-cell-5-26" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span>FlowSolver(...),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="5">5</button><span id="annotated-cell-5-27" class="code-annotation-target"><a href="#annotated-cell-5-27" aria-hidden="true" tabindex="-1"></a>        solver_prefix<span class="op">=</span>{<span class="st">"chain_of_thought"</span>: ...},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="6">6</button><span id="annotated-cell-5-28" class="code-annotation-target"><a href="#annotated-cell-5-28" aria-hidden="true" tabindex="-1"></a>        agent<span class="op">=</span>FlowAgent(...),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="7">7</button><span id="annotated-cell-5-29" class="code-annotation-target"><a href="#annotated-cell-5-29" aria-hidden="true" tabindex="-1"></a>        agent_prefix<span class="op">=</span>{<span class="st">"inspect/"</span>: ...},</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="8">8</button><span id="annotated-cell-5-30" class="code-annotation-target"><a href="#annotated-cell-5-30" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>FlowTask(...),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="9">9</button><span id="annotated-cell-5-31" class="code-annotation-target"><a href="#annotated-cell-5-31" aria-hidden="true" tabindex="-1"></a>        task_prefix<span class="op">=</span>{<span class="st">"inspect_evals/"</span>: ...},</span>
<span id="annotated-cell-5-32"><a href="#annotated-cell-5-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-5-33"><a href="#annotated-cell-5-33" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="annotated-cell-5-34"><a href="#annotated-cell-5-34" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="13,14,15" data-code-annotation="1">Default model generation options. Will be overridden by settings on FlowTask and FlowModel.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="16,17,18" data-code-annotation="2">Field defaults for models.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="19,20,21,22,23,24,25" data-code-annotation="3">Model defaults for model name prefixes. Overrides <code>FlowDefaults.config</code> and <code>FlowDefaults.model</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="26" data-code-annotation="4">Field defaults for solvers.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="27" data-code-annotation="5">Solver defaults for solver name prefixes. Overrides <code>FlowDefaults.solver</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="28" data-code-annotation="6">Field defaults for agents.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="29" data-code-annotation="7">Agent defaults for agent name prefixes. Overrides <code>FlowDefaults.agent</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="30" data-code-annotation="8">Field defaults for tasks.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="31" data-code-annotation="9">Task defaults for task name prefixes. Overrides <code>FlowDefaults.config</code> and <code>FlowDefaults.task</code>. If multiple prefixes match, <strong>longest prefix wins</strong>.</span>
</dd>
</dl>
</section>
<section id="merge-priority-and-behavior" class="level3">
<h3 class="anchored" data-anchor-id="merge-priority-and-behavior">Merge Priority and Behavior</h3>
<p>Defaults follow a hierarchy where <strong>more specific settings override less specific ones</strong>:</p>
<p><strong>For Models:</strong></p>
<ol type="1">
<li>Global config defaults (<code>defaults.config</code>)</li>
<li>Global model defaults (<code>defaults.model</code>)</li>
<li>Model prefix defaults (<code>defaults.model_prefix</code>)</li>
<li>Task-specific config (<code>task.config</code>)</li>
<li>Model-specific config (<code>model.config</code>) — <strong>highest priority</strong></li>
</ol>
<p><strong>Example hierarchy in action:</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>hierarchy.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="annotated-cell-6" data-filename="hierarchy.py"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowDefaults, FlowGenerateConfig, FlowJob, FlowModel, FlowTask</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>    defaults<span class="op">=</span>FlowDefaults(</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-6" class="code-annotation-target"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>            temperature<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>            max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a>        model_prefix<span class="op">=</span>{</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"openai/"</span>: FlowModel(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-11" class="code-annotation-target"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="annotated-cell-6-16"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<span id="annotated-cell-6-17"><a href="#annotated-cell-6-17" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"task"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-18" class="code-annotation-target"><a href="#annotated-cell-6-18" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.7</span>),</span>
<span id="annotated-cell-6-19"><a href="#annotated-cell-6-19" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>FlowModel(</span>
<span id="annotated-cell-6-20"><a href="#annotated-cell-6-20" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-21" class="code-annotation-target"><a href="#annotated-cell-6-21" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">1.0</span>),</span>
<span id="annotated-cell-6-22"><a href="#annotated-cell-6-22" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="annotated-cell-6-23"><a href="#annotated-cell-6-23" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="annotated-cell-6-24"><a href="#annotated-cell-6-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="annotated-cell-6-25"><a href="#annotated-cell-6-25" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="6,7" data-code-annotation="1">Global defaults: <code>temperature=0.0, max_tokens=100</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="11" data-code-annotation="2">Prefix defaults override: <code>temperature=0.5</code> (for OpenAI models)</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="18" data-code-annotation="3">Task config overrides: <code>temperature=0.7</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="21" data-code-annotation="4"><strong>Model config wins</strong>: <code>temperature=1.0, max_tokens=100</code></span>
</dd>
</dl>
<p><strong>Final result:</strong> <code>temperature=1.0</code> (most specific), <code>max_tokens=100</code> (from global defaults)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>None Values Don’t Override
</div>
</div>
<div class="callout-body-container callout-body">
<p>Setting a field to <code>None</code> means “not specified” — it won’t override existing values from defaults. This allows partial configs to merge cleanly:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>FlowTask(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>, max_tokens<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>max_tokens=None</code> doesn’t override a default <code>max_tokens</code> value; it’s simply not set at this level.</p>
</div>
</div>
</section>
<section id="cli-overrides" class="level3">
<h3 class="anchored" data-anchor-id="cli-overrides">CLI Overrides</h3>
<p>Override config values at runtime using the <code>--set</code> flag:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset code-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Basic usage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Nested paths</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">JSON dicts</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Multiple overrides</a></li></ul>
<div class="tab-content code-tabset">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> log_dir=./logs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> options.limit=10</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> defaults.solver.args.tool_calls=none</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--set</span> <span class="st">'options.metadata={"experiment": "baseline", "version": "v1"}'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="dt">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> log_dir=./logs/experiment1 <span class="dt">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> options.limit=100 <span class="dt">\</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> defaults.config.temperature=0.5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Override Behavior
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Strings</strong>: Replace existing values</li>
<li><strong>Dicts</strong>: Replace existing values</li>
<li><strong>Lists</strong>:
<ul>
<li>String values append to existing list</li>
<li>Lists replace existing list</li>
</ul></li>
</ul>
<p><strong>Examples:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appends to list</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--set</span> dependencies=new_package</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replaces list</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">--set</span> <span class="st">'dependencies=["pkg1", "pkg2"]'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="environment-variables">Environment Variables</h3>
<p>Set config values via environment variables:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_LOG_DIR</span><span class="op">=</span>./logs/custom</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_LIMIT</span><span class="op">=</span>50</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_SET</span><span class="op">=</span><span class="st">"options.metadata={</span><span class="dt">\"</span><span class="st">key</span><span class="dt">\"</span><span class="st">: </span><span class="dt">\"</span><span class="st">value</span><span class="dt">\"</span><span class="st">}"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">INSPECT_FLOW_VAR</span><span class="op">=</span><span class="st">"task_min_priority=2"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Supported environment variables:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Equivalent Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>INSPECT_FLOW_LOG_DIR</code></td>
<td><code>--log-dir</code></td>
<td>Override log directory</td>
</tr>
<tr class="even">
<td><code>INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE</code></td>
<td><code>--log-dir-create-unique</code></td>
<td>Create new log directory with numeric suffix if exists</td>
</tr>
<tr class="odd">
<td><code>INSPECT_FLOW_LIMIT</code></td>
<td><code>--limit</code></td>
<td>Limit number of samples</td>
</tr>
<tr class="even">
<td><code>INSPECT_FLOW_SET</code></td>
<td><code>--set</code></td>
<td>Set config overrides (can be specified multiple times)</td>
</tr>
<tr class="odd">
<td><code>INSPECT_FLOW_VAR</code></td>
<td><code>--var</code></td>
<td>Set variables for <code>__flow_vars__</code> (can be multiple)</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Override Priority
</div>
</div>
<div class="callout-body-container callout-body">
<p>Setting defaults via the command line will override the defaults which in turn might be overridden by anything set explicitly.</p>
<p>Dedicated environment variables (see <strong>Supported environment variables</strong> above) and corresponding CLI flags will override the <code>--set</code> flag.</p>
<p>Dedicated CLI flags have the highest priority.</p>
<p>Priority order of <code>log-dir</code>, <code>log-dir-create-unique</code> and <code>limit</code>:</p>
<ol type="1">
<li>FlowJob defaults</li>
<li>Explicit setting on the FlowJob</li>
<li><code>INSPECT_FLOW_SET_</code> environment variables</li>
<li>CLI <code>--set</code> flags</li>
<li><code>INSPECT_FLOW_LOG_DIR</code>, <code>INSPECT_FLOW_LOG_DIR_CREATE_UNIQUE</code> and <code>INSPECT_FLOW_LIMIT</code> environment variables</li>
<li>Explicit <code>--log-dir</code>, <code>--log-dir-create-unique</code> and <code>--limit</code> CLI flags</li>
</ol>
<p>All other settings follow the priority order:</p>
<ol type="1">
<li>FlowJob defaults</li>
<li>Explicit setting on the FlowJob</li>
<li><code>INSPECT_FLOW_SET_</code> environment variables</li>
<li>CLI <code>--set</code> flags</li>
</ol>
</div>
</div>
</section>
<section id="debugging-defaults-resolution" class="level3">
<h3 class="anchored" data-anchor-id="debugging-defaults-resolution">Debugging Defaults Resolution</h3>
<p>To see the fully resolved configuration with all defaults applied:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows exactly what settings each task will use after applying all defaults and overrides.</p>
</section>
</section>
<section id="configuration-inheritance" class="level2">
<h2 class="anchored" data-anchor-id="configuration-inheritance">Configuration Inheritance</h2>
<p>Inspect Flow supports configuration inheritance through two mechanisms:</p>
<section id="explicit-includes" class="level3">
<h3 class="anchored" data-anchor-id="explicit-includes">Explicit Includes</h3>
<p>Use the <code>includes</code> field to explicitly merge other config files into your job:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    includes<span class="op">=</span>[<span class="st">"defaults_flow.py"</span>],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"./logs/flow_test"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[<span class="st">"my_task"</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Included configs are merged recursively, with the current config’s values taking precedence over included values. For dictionaries, fields are merged deeply. For lists, items are concatenated with duplicates removed.</p>
</section>
<section id="automatic-discovery" class="level3">
<h3 class="anchored" data-anchor-id="automatic-discovery">Automatic Discovery</h3>
<p>Inspect Flow automatically discovers and includes files named <code>_flow.py</code> in parent directories. Starting from your config file’s location, it searches upward through the directory tree for <code>_flow.py</code> files and automatically merges them as base configurations.</p>
<p>This allows you to define shared defaults (model settings, dependencies, etc.) at a repository root that apply to all configs in subdirectories without explicit includes.</p>
</section>
</section>
<section id="parameter-sweeping" class="level2">
<h2 class="anchored" data-anchor-id="parameter-sweeping">Parameter Sweeping</h2>
<p>Parameter sweeping lets you systematically explore evaluation configurations by generating Cartesian products of parameters. Instead of manually writing every combination, Flow provides matrix and “with” functions to declaratively generate evaluation grids.</p>
<section id="matrix-functions-cartesian-products" class="level3">
<h3 class="anchored" data-anchor-id="matrix-functions-cartesian-products">Matrix Functions (Cartesian Products)</h3>
<p>Matrix functions generate all combinations of their parameters using Cartesian products.</p>
<section id="tasks_matrix" class="level4">
<h4 class="anchored" data-anchor-id="tasks_matrix">tasks_matrix()</h4>
<p>Generate task configurations by combining tasks with models, configs, solvers, and arguments:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tasks_matrix.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22" data-filename="tasks_matrix.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, tasks_matrix</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/gpqa_diamond"</span>, <span class="st">"inspect_evals/mmlu_0_shot"</span>],</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"anthropic/claude-3-5-sonnet"</span>],</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>4 tasks</strong> (2 tasks × 2 models).</p>
</section>
<section id="models_matrix" class="level4">
<h4 class="anchored" data-anchor-id="models_matrix">models_matrix()</h4>
<p>Generate model configurations with different generation settings:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>models_matrix.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23" data-filename="models_matrix.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowGenerateConfig, FlowJob, models_matrix, tasks_matrix</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"inspect_evals/mmlu_0_shot"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>models_matrix(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>[</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"openai/gpt-5"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"openai/gpt-5-mini"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>[</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"minimal"</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"low"</span>),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"medium"</span>),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"high"</span>),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>16 tasks</strong> (2 task × 2 models × 4 resoning_effort).</p>
</section>
<section id="configs_matrix" class="level4">
<h4 class="anchored" data-anchor-id="configs_matrix">configs_matrix()</h4>
<p>Generate generation config combinations by specifying individual parameters:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>configs_matrix.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24" data-filename="configs_matrix.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, configs_matrix, models_matrix, tasks_matrix</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"inspect_evals/mmlu_0_shot"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>models_matrix(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span>[</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"openai/gpt-5"</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"openai/gpt-5-mini"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>            config<span class="op">=</span>configs_matrix(</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                reasoning_effort<span class="op">=</span>[<span class="st">"minimal"</span>, <span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>],</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>16 tasks</strong> (2 task × 2 models × 4 resoning_effort).</p>
</section>
<section id="solvers_matrix-and-agents_matrix" class="level4">
<h4 class="anchored" data-anchor-id="solvers_matrix-and-agents_matrix">solvers_matrix() and agents_matrix()</h4>
<p>Generate solver or agent configurations with different arguments:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>solvers_matrix.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25" data-filename="solvers_matrix.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, solvers_matrix, tasks_matrix</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"my_task"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        solver<span class="op">=</span>solvers_matrix(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            solver<span class="op">=</span><span class="st">"chain_of_thought"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            args<span class="op">=</span>[</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">3</span>},</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">5</span>},</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                {<span class="st">"max_iterations"</span>: <span class="dv">10</span>},</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>3 tasks</strong> (1 task × 3 solver configurations).</p>
</section>
</section>
<section id="with-functions-apply-to-all" class="level3">
<h3 class="anchored" data-anchor-id="with-functions-apply-to-all">With Functions (Apply to All)</h3>
<p>“With” functions apply the same value to all items in a list. Use these when you want to sweep over some parameters while keeping others constant.</p>
<section id="tasks_with" class="level4">
<h4 class="anchored" data-anchor-id="tasks_with">tasks_with()</h4>
<p>Apply common settings to multiple tasks:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tasks_with.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26" data-filename="tasks_with.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowGenerateConfig, FlowJob, tasks_with</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_with(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/gpqa_diamond"</span>, <span class="st">"inspect_evals/mmlu_0_shot"</span>],</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,  <span class="co"># Same model for both tasks</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.7</span>),  <span class="co"># Same config for both</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>2 tasks</strong> (2 tasks, each with the same model and config).</p>
</section>
<section id="combining-matrix-and-with" class="level4">
<h4 class="anchored" data-anchor-id="combining-matrix-and-with">Combining Matrix and With</h4>
<p>Mix parameter sweeps with common settings:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>matrix_and_with.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27" data-filename="matrix_and_with.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> (</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    FlowJob,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    configs_matrix,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    tasks_matrix,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    tasks_with,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_with(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>tasks_matrix(</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            task<span class="op">=</span>[<span class="st">"task1"</span>, <span class="st">"task2"</span>], config<span class="op">=</span>configs_matrix(temperature<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>])</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        ),  <span class="co"># Creates 6 tasks (2 × 3)</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,  <span class="co"># Applied to all 6 tasks</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        sandbox<span class="op">=</span><span class="st">"docker"</span>,  <span class="co"># Applied to all 6 tasks</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="nested-sweeps" class="level3">
<h3 class="anchored" data-anchor-id="nested-sweeps">Nested Sweeps</h3>
<p>Matrix functions can be nested to create complex parameter grids. Use the unpacking operator <code>*</code> to expand inner matrix results:</p>
<p><strong>Example: Tasks with nested model sweep</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>nested_model_sweep.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28" data-filename="nested_model_sweep.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowGenerateConfig, FlowJob, models_matrix, tasks_matrix</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[<span class="st">"inspect_evals/mmlu_0_shot"</span>, <span class="st">"inspect_evals/gpqa_diamond"</span>],</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"anthropic/claude-3-5-sonnet"</span>,  <span class="co"># Single model</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>models_matrix(  <span class="co"># Unpacks list of 4 model configs</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span>[<span class="st">"openai/gpt-4o"</span>, <span class="st">"openai/gpt-4o-mini"</span>],</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                config<span class="op">=</span>[</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                    FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"low"</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                    FlowGenerateConfig(reasoning_effort<span class="op">=</span><span class="st">"high"</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        ],  <span class="co"># Total: 1 + 4 = 5 models</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>10 tasks</strong> (2 tasks × 5 model configurations).</p>
<p><strong>Example: Tasks with nested task sweep</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>nested_task_sweep.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29" data-filename="nested_task_sweep.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask, tasks_matrix</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>[</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            FlowTask(name<span class="op">=</span><span class="st">"task1"</span>, args<span class="op">=</span>{<span class="st">"subset"</span>: <span class="st">"test"</span>}),  <span class="co"># Single task</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>tasks_matrix(  <span class="co"># Unpacks list of 3 tasks</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                task<span class="op">=</span><span class="st">"task2"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                args<span class="op">=</span>[</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"en"</span>},</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"de"</span>},</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"language"</span>: <span class="st">"fr"</span>},</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        ],  <span class="co"># Total: 1 + 3 = 4 tasks</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>[<span class="st">"model1"</span>, <span class="st">"model2"</span>],</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This creates <strong>8 tasks</strong> (4 task variants × 2 models).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Watch Out for Combinatorial Explosion
</div>
</div>
<div class="callout-body-container callout-body">
<p>Parameter sweeps grow multiplicatively. A sweep with: - 3 tasks - 4 models - 5 temperature values - 3 solver configurations</p>
<p>Results in 3 × 4 × 5 × 3 = <strong>180 evaluations</strong>.</p>
<p>Always use <code>--dry-run</code> to check the number of evaluations before running expensive grids.</p>
</div>
</div>
</section>
<section id="config-merging-behavior" class="level3">
<h3 class="anchored" data-anchor-id="config-merging-behavior">Config Merging Behavior</h3>
<p>When base objects already have values, matrix parameters are merged:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Config fields merge recursively</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tasks_matrix(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    task<span class="op">=</span>FlowTask(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"task"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>FlowGenerateConfig(temperature<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Base value</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    config<span class="op">=</span>[</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        FlowGenerateConfig(max_tokens<span class="op">=</span><span class="dv">1000</span>),  <span class="co"># Adds max_tokens, keeps temperature=0.5</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        FlowGenerateConfig(max_tokens<span class="op">=</span><span class="dv">2000</span>),  <span class="co"># Adds max_tokens, keeps temperature=0.5</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="running-evaluations" class="level2">
<h2 class="anchored" data-anchor-id="running-evaluations">Running Evaluations</h2>
<p>Once you’ve defined your Flow configuration, you can execute evaluations using the <code>flow run</code> command. Flow also provides tools for previewing configurations and controlling runtime behavior.</p>
<section id="the-flow-run-command" class="level3">
<h3 class="anchored" data-anchor-id="the-flow-run-command">The <code>flow run</code> Command</h3>
<p>Execute your evaluation workflow:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What happens when you run this:</strong></p>
<ol type="1">
<li>Flow loads your configuration file</li>
<li>Creates an isolated virtual environment</li>
<li>Installs dependencies</li>
<li>Resolves all defaults and matrix expansions</li>
<li>Executes evaluations via Inspect AI’s <code>eval_set()</code></li>
<li>Stores logs in <code>log_dir</code></li>
<li>Cleans up the temporary environment</li>
</ol>
<section id="common-cli-flags" class="level4">
<h4 class="anchored" data-anchor-id="common-cli-flags">Common CLI Flags</h4>
<p><strong>Preview without running:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--dry-run</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Shows how many tasks would be executed without actually running them. Useful for validating large parameter sweeps.</p>
<pre><code>eval_set would be called with 24 tasks</code></pre>
<p><strong>Override log directory:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--log-dir</span> ./experiments/baseline</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Changes where logs and results are stored.</p>
<p><strong>Runtime overrides:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="dt">\</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> options.limit=100 <span class="dt">\</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--set</span> defaults.config.temperature=0.5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Override any configuration value at runtime. See <a href="#cli-overrides">CLI Overrides</a> for more details.</p>
</section>
</section>
<section id="the-flow-config-command" class="level3">
<h3 class="anchored" data-anchor-id="the-flow-config-command">The <code>flow config</code> Command</h3>
<p>Preview your configuration before running:</p>
<p><strong>Basic usage:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Displays the parsed configuration as YAML with CLI overrides applied. Does not create a virtual environment or instantiate Python objects.</p>
<p><strong>Full resolution:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> config config.py <span class="at">--resolve</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Shows the completely resolved configuration:</p>
<ul>
<li>Creates virtual environment</li>
<li>Applies all defaults</li>
<li>Expands all matrix functions</li>
<li>Instantiates all Python objects</li>
</ul>
<p>This is invaluable for debugging what settings will actually be used in your evaluations.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Use Each Command
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong><code>flow config</code></strong> - Quick syntax check, verify overrides</li>
<li><strong><code>flow config --resolve</code></strong> - Debug defaults resolution, inspect final settings</li>
<li><strong><code>flow run --dry-run</code></strong> - Count tasks in parameter sweeps, validate before expensive runs</li>
<li><strong><code>flow run</code></strong> - Execute evaluations</li>
</ul>
</div>
</div>
</section>
<section id="results-and-logs" class="level3">
<h3 class="anchored" data-anchor-id="results-and-logs">Results and Logs</h3>
<section id="flow-directory-structure" class="level4">
<h4 class="anchored" data-anchor-id="flow-directory-structure">Flow Directory Structure</h4>
<p>Evaluation results are stored in the <code>log_dir</code>:</p>
<pre><code>logs/
├── 2025-11-21T17-38-20+01-00_gpqa-diamond_KvJBGowidXSCLRhkKQbHYA.eval
├── 2025-11-21T17-38-20+01-00_mmlu-0-shot_Vnu2A3M2wPet5yobLiCQmZ.eval
├── .eval-set-id
├── eval-set.json
├── flow.yaml
└── ...</code></pre>
<p><strong>Directory structure:</strong></p>
<ul>
<li>Flow passes the <code>log_dir</code> directly to Inspect AI <code>eval_set()</code> for evaluation log storage</li>
<li>Inspect AI handles the actual evaluation log file naming and storage</li>
<li>Log file naming conventions follow Inspect AI’s standards (see <a href="https://inspect.aisi.org.uk/eval-logs.html#log-file-name">Inspect AI logging docs</a>)</li>
<li>Flow automatically saves the resolved configuration as <code>flow.yaml</code> in the log directory</li>
<li>The <code>.eval-set-id</code> file contains the eval set identifier</li>
<li>The <code>eval-set.json</code> file contains eval set metadata</li>
</ul>
<p><strong>Log formats:</strong></p>
<ul>
<li><code>.eval</code> - Binary Inspect AI log format (default, high-performance)</li>
<li><code>.json</code> - JSON format (if <code>log_format="json"</code> in FlowOptions)</li>
</ul>
</section>
<section id="viewing-results" class="level4">
<h4 class="anchored" data-anchor-id="viewing-results">Viewing Results</h4>
<p><strong>Using Inspect View:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">inspect</span> view</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Opens the Inspect AI viewer to explore evaluation logs interactively.</p>
</section>
<section id="s3-support" class="level4">
<h4 class="anchored" data-anchor-id="s3-support">S3 Support</h4>
<p>Store logs directly to S3:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"s3://my-bucket/experiments/baseline"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[...]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
</section>
<section id="advanced-features" class="level2">
<h2 class="anchored" data-anchor-id="advanced-features">Advanced Features</h2>
<section id="metadata-management" class="level3">
<h3 class="anchored" data-anchor-id="metadata-management">Metadata Management</h3>
<p>Flow supports two types of metadata with distinct purposes: <code>metadata</code> and <code>flow_metadata</code>.</p>
<section id="metadata-inspect-ai-metadata" class="level4">
<h4 class="anchored" data-anchor-id="metadata-inspect-ai-metadata">metadata (Inspect AI Metadata)</h4>
<p>The <code>metadata</code> field in <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowoptions">FlowOptions</a></span> and <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowtask">FlowTask</a></span> is passed directly to Inspect AI and stored in evaluation logs. Use this for tracking experiment information that should be accessible in Inspect AI’s log viewer and analysis tools.</p>
<p><strong>Example:</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>metadata.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41" data-filename="metadata.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowOptions, FlowTask</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">=</span>{</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"experiment"</span>: <span class="st">"baseline_v1"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"hypothesis"</span>: <span class="st">"Higher temperature improves creative tasks"</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"hardware"</span>: <span class="st">"A100-80GB"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>        FlowTask(</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>            model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span>{</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"task_variant"</span>: <span class="st">"chemistry_subset"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"note"</span>: <span class="st">"Testing with reduced context"</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The metadata from <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowoptions">FlowOptions</a></span> is applied globally to all tasks in the evaluation run, while task-level metadata is specific to each task.</p>
</section>
<section id="flow_metadata-flow-only-metadata" class="level4">
<h4 class="anchored" data-anchor-id="flow_metadata-flow-only-metadata">flow_metadata (Flow-Only Metadata)</h4>
<p>The <code>flow_metadata</code> field is available on <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowjob">FlowJob</a></span>, <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowtask">FlowTask</a></span>, <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowmodel">FlowModel</a></span>, <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowsolver">FlowSolver</a></span>, and <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowagent">FlowAgent</a></span>. This metadata is <strong>not passed to Inspect AI</strong>—it exists only in the Flow configuration and is useful for configuration-time logic and organization.</p>
<p><strong>Use cases:</strong></p>
<ul>
<li>Filtering or selecting configurations based on properties</li>
<li>Organizing complex configuration generation logic</li>
<li>Documenting configuration decisions</li>
<li>Annotating configs without polluting Inspect AI logs</li>
</ul>
<p><strong>Example: Configuration-time filtering</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>flow_metadata.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42" data-filename="flow_metadata.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowModel, tasks_matrix</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define models with metadata about capabilities</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    FlowModel(name<span class="op">=</span><span class="st">"openai/gpt-4o"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">128000</span>}),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    FlowModel(name<span class="op">=</span><span class="st">"openai/gpt-4o-mini"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">128000</span>}),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    FlowModel(</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"anthropic/claude-3-5-sonnet"</span>, flow_metadata<span class="op">=</span>{<span class="st">"context_window"</span>: <span class="dv">200000</span>}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to only long-context models</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>long_context_models <span class="op">=</span> [</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    m</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> models</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m.flow_metadata <span class="kw">and</span> m.flow_metadata.get(<span class="st">"context_window"</span>, <span class="dv">0</span>) <span class="op">&gt;=</span> <span class="dv">128000</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>tasks_matrix(</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span><span class="st">"long_context_task"</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>long_context_models,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="variable-substitution" class="level3">
<h3 class="anchored" data-anchor-id="variable-substitution">Variable Substitution</h3>
<section id="flow-variables---var" class="level4">
<h4 class="anchored" data-anchor-id="flow-variables---var">Flow Variables (<code>--var</code>)</h4>
<p>Pass custom variables to Python config files using <code>--var</code> or the <code>INSPECT_FLOW_VAR</code> environment variable. Use this for dynamic configuration that isn’t available via <code>--set</code>. Variables are accessible via the <code>__flow_vars__</code> dictionary:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flow</span> run config.py <span class="at">--var</span> task_min_priority=2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>flow_vars.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44" data-filename="flow_vars.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>task_min_priority <span class="op">=</span> <span class="bu">globals</span>().get(<span class="st">"__flow_vars__"</span>, {}).get(<span class="st">"task_min_priority"</span>, <span class="dv">1</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>all_tasks <span class="op">=</span> [</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    FlowTask(name<span class="op">=</span><span class="st">"task_easy"</span>, flow_metadata<span class="op">=</span>{<span class="st">"priority"</span>: <span class="dv">1</span>}),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    FlowTask(name<span class="op">=</span><span class="st">"task_medium"</span>, flow_metadata<span class="op">=</span>{<span class="st">"priority"</span>: <span class="dv">2</span>}),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    FlowTask(name<span class="op">=</span><span class="st">"task_hard"</span>, flow_metadata<span class="op">=</span>{<span class="st">"priority"</span>: <span class="dv">3</span>}),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        t</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> all_tasks</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (t.flow_metadata <span class="kw">or</span> {}).get(<span class="st">"priority"</span>, <span class="dv">0</span>) <span class="op">&gt;=</span> task_min_priority</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="template-substitution" class="level4">
<h4 class="anchored" data-anchor-id="template-substitution">Template Substitution</h4>
<p>Use <code>{field_name}</code> syntax to reference other FlowJob configuration values. Substitutions are applied after the config is loaded:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs/my_eval"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(bundle_dir<span class="op">=</span><span class="st">"</span><span class="sc">{log_dir}</span><span class="st">/bundle"</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Result: bundle_dir="logs/my_eval/bundle"</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For nested fields, use bracket notation: <code>{options[eval_set_id]}</code> or <code>{flow_metadata[key]}</code>. Substitutions are resolved recursively until no more remain.</p>
</section>
</section>
<section id="bundle-url-mapping" class="level3">
<h3 class="anchored" data-anchor-id="bundle-url-mapping">Bundle URL Mapping</h3>
<p>Convert local bundle paths to public URLs for sharing evaluation results. The <code>bundle_url_map</code> in <span class="element-type-name ref-interlink"><a href="./reference/inspect_flow.html#flowoptions">FlowOptions</a></span> applies string replacements to <code>bundle_dir</code> to generate a shareable URL that’s printed to stdout after the evaluation completes.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>bundle_url_map.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46" data-filename="bundle_url_map.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowOptions, FlowTask</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs/my_eval"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        bundle_dir<span class="op">=</span><span class="st">"/local/storage/bundles/my_eval"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        bundle_url_map<span class="op">=</span>{<span class="st">"/local/storage"</span>: <span class="st">"https://example.com/shared"</span>},</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[FlowTask(name<span class="op">=</span><span class="st">"task"</span>, model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>)],</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>After running this prints: <code>Bundle URL: https://example.com/shared/bundles/my_eval</code></p>
<p>Use this when storing bundles on servers with public HTTP access or cloud storage with URL mapping. Multiple mappings are applied in order.</p>
</section>
<section id="configuration-scripts" class="level3">
<h3 class="anchored" data-anchor-id="configuration-scripts">Configuration Scripts</h3>
<p>Included configuration files can execute validation code to enforce constraints. Files named <code>_flow.py</code> are automatically included from parent directories, and receive <code>__flow_including_jobs__</code> containing all configs in the include chain.</p>
<p><strong>Terminology:</strong></p>
<ul>
<li><strong>Including config</strong>: The file being loaded (e.g., <code>my_config.py</code>)</li>
<li><strong>Included config</strong>: The <code>_flow.py</code> file(s) automatically inherited from parent directories</li>
</ul>
<p>The included config can inspect the including configs to validate or enforce constraints.</p>
<section id="prevent-runs-with-uncommitted-changes" class="level4">
<h4 class="anchored" data-anchor-id="prevent-runs-with-uncommitted-changes">Prevent Runs with Uncommitted Changes</h4>
<p>Place a <code>_flow.py</code> file at your repository root to validate that all configs are in clean git repositories. This validation runs automatically for all configs in subdirectories.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>_flow.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47" data-filename="_flow.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all configs that are including this one</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>including_jobs: <span class="bu">dict</span>[<span class="bu">str</span>, FlowJob] <span class="op">=</span> <span class="bu">globals</span>().get(<span class="st">"__flow_including_jobs__"</span>, {})</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_repo(path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    abs_path <span class="op">=</span> Path(path).resolve()</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    check_dir <span class="op">=</span> abs_path <span class="cf">if</span> abs_path.is_dir() <span class="cf">else</span> abs_path.parent</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> subprocess.run(</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"git"</span>, <span class="st">"status"</span>, <span class="st">"--porcelain"</span>],</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        cwd<span class="op">=</span>check_dir,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        capture_output<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.stdout.strip():</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="ss">f"The repository at </span><span class="sc">{</span>check_dir<span class="sc">}</span><span class="ss"> has uncommitted changes."</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Check this config and all configs including it</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>check_repo(<span class="va">__file__</span>)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> including_jobs.keys():</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    check_repo(path)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>FlowJob()  <span class="co"># Return empty job for inheritance</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>config.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48" data-filename="config.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Automatically inherits _flow.py</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowTask</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    dependencies<span class="op">=</span>[<span class="st">"inspect-evals"</span>],</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[FlowTask(name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>, model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>)],</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Will fail if uncommitted changes exist in the repository</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="lock-configuration-fields" class="level4">
<h4 class="anchored" data-anchor-id="lock-configuration-fields">Lock Configuration Fields</h4>
<p>A <code>_flow.py</code> file can prevent configs from overriding critical settings:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>_flow.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49" data-filename="_flow.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowOptions</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>MAX_SAMPLES <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all configs that are including this one</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>including_jobs: <span class="bu">dict</span>[<span class="bu">str</span>, FlowJob] <span class="op">=</span> <span class="bu">globals</span>().get(<span class="st">"__flow_including_jobs__"</span>, {})</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate that including configs don't override MAX_SAMPLES</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span>, job <span class="kw">in</span> including_jobs.items():</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        job.options</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> job.options.max_samples <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">and</span> job.options.max_samples <span class="op">!=</span> MAX_SAMPLES</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Do not override max_samples! Error in </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> (or its includes)"</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(max_samples<span class="op">=</span>MAX_SAMPLES),</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>config.py</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50" data-filename="config.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Automatically inherits _flow.py</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> inspect_flow <span class="im">import</span> FlowJob, FlowOptions, FlowTask</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>FlowJob(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    log_dir<span class="op">=</span><span class="st">"logs"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>FlowOptions(max_samples<span class="op">=</span><span class="dv">32</span>),  <span class="co"># Will raise ValueError!</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    tasks<span class="op">=</span>[FlowTask(name<span class="op">=</span><span class="st">"inspect_evals/gpqa_diamond"</span>, model<span class="op">=</span><span class="st">"openai/gpt-4o"</span>)],</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This pattern is useful for enforcing organizational standards (resource limits, safety constraints, etc.) across all evaluation configs in a repository.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/meridianlabs-ai\.github\.io\/inspect_flow");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            trigger: 'click',
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            positionFixed: true,
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html#basic-examples" class="pagination-link" aria-label="Basic Examples">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Basic Examples</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./usage.html#core-concepts" class="pagination-link" aria-label="Core Concepts">
        <span class="nav-page-text">Core Concepts</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/">
<p>Meridian Labs</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow">
<p>Code</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow/blob/main/LICENSE">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow/issues">
<p>Issues</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/meridianlabs-ai/inspect_flow/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/meridianlabs-ai/inspect_flow">
<p>Code</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>